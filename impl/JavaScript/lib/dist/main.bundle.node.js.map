{
  "version": 3,
  "sources": ["../node_modules/scrypt-js/scrypt.js", "../src/binascii.js", "../src/random.js", "../src/str.js", "../src/exceptions.js", "../src/scrypt-layer/scrypt-node.js", "../src/internal-util.js", "../src/encrypt_data.js", "../src/derive_key.js", "../src/encrypt_file.js", "../src/key_management.js", "../src/context.js", "../src/stream.js", "../src/internal-expose.js", "../src/util-wrappers.js", "../src/version.js"],
  "sourcesContent": ["\"use strict\";\n\n(function(root) {\n    const MAX_VALUE = 0x7fffffff;\n\n    // The SHA256 and PBKDF2 implementation are from scrypt-async-js:\n    // See: https://github.com/dchest/scrypt-async-js\n    function SHA256(m) {\n        const K = new Uint32Array([\n           0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b,\n           0x59f111f1, 0x923f82a4, 0xab1c5ed5, 0xd807aa98, 0x12835b01,\n           0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7,\n           0xc19bf174, 0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc,\n           0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da, 0x983e5152,\n           0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147,\n           0x06ca6351, 0x14292967, 0x27b70a85, 0x2e1b2138, 0x4d2c6dfc,\n           0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,\n           0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819,\n           0xd6990624, 0xf40e3585, 0x106aa070, 0x19a4c116, 0x1e376c08,\n           0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f,\n           0x682e6ff3, 0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208,\n           0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2\n       ]);\n\n        let h0 = 0x6a09e667, h1 = 0xbb67ae85, h2 = 0x3c6ef372, h3 = 0xa54ff53a;\n        let h4 = 0x510e527f, h5 = 0x9b05688c, h6 = 0x1f83d9ab, h7 = 0x5be0cd19;\n        const w = new Uint32Array(64);\n\n        function blocks(p) {\n            let off = 0, len = p.length;\n            while (len >= 64) {\n                let a = h0, b = h1, c = h2, d = h3, e = h4, f = h5, g = h6, h = h7, u, i, j, t1, t2;\n\n                for (i = 0; i < 16; i++) {\n                    j = off + i*4;\n                    w[i] = ((p[j] & 0xff)<<24) | ((p[j+1] & 0xff)<<16) |\n                    ((p[j+2] & 0xff)<<8) | (p[j+3] & 0xff);\n                }\n\n                for (i = 16; i < 64; i++) {\n                    u = w[i-2];\n                    t1 = ((u>>>17) | (u<<(32-17))) ^ ((u>>>19) | (u<<(32-19))) ^ (u>>>10);\n\n                    u = w[i-15];\n                    t2 = ((u>>>7) | (u<<(32-7))) ^ ((u>>>18) | (u<<(32-18))) ^ (u>>>3);\n\n                    w[i] = (((t1 + w[i-7]) | 0) + ((t2 + w[i-16]) | 0)) | 0;\n                }\n\n                for (i = 0; i < 64; i++) {\n                    t1 = ((((((e>>>6) | (e<<(32-6))) ^ ((e>>>11) | (e<<(32-11))) ^\n                             ((e>>>25) | (e<<(32-25)))) + ((e & f) ^ (~e & g))) | 0) +\n                          ((h + ((K[i] + w[i]) | 0)) | 0)) | 0;\n\n                    t2 = ((((a>>>2) | (a<<(32-2))) ^ ((a>>>13) | (a<<(32-13))) ^\n                           ((a>>>22) | (a<<(32-22)))) + ((a & b) ^ (a & c) ^ (b & c))) | 0;\n\n                    h = g;\n                    g = f;\n                    f = e;\n                    e = (d + t1) | 0;\n                    d = c;\n                    c = b;\n                    b = a;\n                    a = (t1 + t2) | 0;\n                }\n\n                h0 = (h0 + a) | 0;\n                h1 = (h1 + b) | 0;\n                h2 = (h2 + c) | 0;\n                h3 = (h3 + d) | 0;\n                h4 = (h4 + e) | 0;\n                h5 = (h5 + f) | 0;\n                h6 = (h6 + g) | 0;\n                h7 = (h7 + h) | 0;\n\n                off += 64;\n                len -= 64;\n            }\n        }\n\n        blocks(m);\n\n        let i, bytesLeft = m.length % 64,\n        bitLenHi = (m.length / 0x20000000) | 0,\n        bitLenLo = m.length << 3,\n        numZeros = (bytesLeft < 56) ? 56 : 120,\n        p = m.slice(m.length - bytesLeft, m.length);\n\n        p.push(0x80);\n        for (i = bytesLeft + 1; i < numZeros; i++) { p.push(0); }\n        p.push((bitLenHi >>> 24) & 0xff);\n        p.push((bitLenHi >>> 16) & 0xff);\n        p.push((bitLenHi >>> 8)  & 0xff);\n        p.push((bitLenHi >>> 0)  & 0xff);\n        p.push((bitLenLo >>> 24) & 0xff);\n        p.push((bitLenLo >>> 16) & 0xff);\n        p.push((bitLenLo >>> 8)  & 0xff);\n        p.push((bitLenLo >>> 0)  & 0xff);\n\n        blocks(p);\n\n        return [\n            (h0 >>> 24) & 0xff, (h0 >>> 16) & 0xff, (h0 >>> 8) & 0xff, (h0 >>> 0) & 0xff,\n            (h1 >>> 24) & 0xff, (h1 >>> 16) & 0xff, (h1 >>> 8) & 0xff, (h1 >>> 0) & 0xff,\n            (h2 >>> 24) & 0xff, (h2 >>> 16) & 0xff, (h2 >>> 8) & 0xff, (h2 >>> 0) & 0xff,\n            (h3 >>> 24) & 0xff, (h3 >>> 16) & 0xff, (h3 >>> 8) & 0xff, (h3 >>> 0) & 0xff,\n            (h4 >>> 24) & 0xff, (h4 >>> 16) & 0xff, (h4 >>> 8) & 0xff, (h4 >>> 0) & 0xff,\n            (h5 >>> 24) & 0xff, (h5 >>> 16) & 0xff, (h5 >>> 8) & 0xff, (h5 >>> 0) & 0xff,\n            (h6 >>> 24) & 0xff, (h6 >>> 16) & 0xff, (h6 >>> 8) & 0xff, (h6 >>> 0) & 0xff,\n            (h7 >>> 24) & 0xff, (h7 >>> 16) & 0xff, (h7 >>> 8) & 0xff, (h7 >>> 0) & 0xff\n        ];\n    }\n\n    function PBKDF2_HMAC_SHA256_OneIter(password, salt, dkLen) {\n        // compress password if it's longer than hash block length\n        password = (password.length <= 64) ? password : SHA256(password);\n\n        const innerLen = 64 + salt.length + 4;\n        const inner = new Array(innerLen);\n        const outerKey = new Array(64);\n\n        let i;\n        let dk = [];\n\n        // inner = (password ^ ipad) || salt || counter\n        for (i = 0; i < 64; i++) { inner[i] = 0x36; }\n        for (i = 0; i < password.length; i++) { inner[i] ^= password[i]; }\n        for (i = 0; i < salt.length; i++) { inner[64 + i] = salt[i]; }\n        for (i = innerLen - 4; i < innerLen; i++) { inner[i] = 0; }\n\n        // outerKey = password ^ opad\n        for (i = 0; i < 64; i++) outerKey[i] = 0x5c;\n        for (i = 0; i < password.length; i++) outerKey[i] ^= password[i];\n\n        // increments counter inside inner\n        function incrementCounter() {\n            for (let i = innerLen - 1; i >= innerLen - 4; i--) {\n                inner[i]++;\n                if (inner[i] <= 0xff) return;\n                inner[i] = 0;\n            }\n        }\n\n        // output blocks = SHA256(outerKey || SHA256(inner)) ...\n        while (dkLen >= 32) {\n            incrementCounter();\n            dk = dk.concat(SHA256(outerKey.concat(SHA256(inner))));\n            dkLen -= 32;\n        }\n        if (dkLen > 0) {\n            incrementCounter();\n            dk = dk.concat(SHA256(outerKey.concat(SHA256(inner))).slice(0, dkLen));\n        }\n\n        return dk;\n    }\n\n    // The following is an adaptation of scryptsy\n    // See: https://www.npmjs.com/package/scryptsy\n    function blockmix_salsa8(BY, Yi, r, x, _X) {\n        let i;\n\n        arraycopy(BY, (2 * r - 1) * 16, _X, 0, 16);\n        for (i = 0; i < 2 * r; i++) {\n            blockxor(BY, i * 16, _X, 16);\n            salsa20_8(_X, x);\n            arraycopy(_X, 0, BY, Yi + (i * 16), 16);\n        }\n\n        for (i = 0; i < r; i++) {\n            arraycopy(BY, Yi + (i * 2) * 16, BY, (i * 16), 16);\n        }\n\n        for (i = 0; i < r; i++) {\n            arraycopy(BY, Yi + (i * 2 + 1) * 16, BY, (i + r) * 16, 16);\n        }\n    }\n\n    function R(a, b) {\n        return (a << b) | (a >>> (32 - b));\n    }\n\n    function salsa20_8(B, x) {\n        arraycopy(B, 0, x, 0, 16);\n\n        for (let i = 8; i > 0; i -= 2) {\n            x[ 4] ^= R(x[ 0] + x[12], 7);\n            x[ 8] ^= R(x[ 4] + x[ 0], 9);\n            x[12] ^= R(x[ 8] + x[ 4], 13);\n            x[ 0] ^= R(x[12] + x[ 8], 18);\n            x[ 9] ^= R(x[ 5] + x[ 1], 7);\n            x[13] ^= R(x[ 9] + x[ 5], 9);\n            x[ 1] ^= R(x[13] + x[ 9], 13);\n            x[ 5] ^= R(x[ 1] + x[13], 18);\n            x[14] ^= R(x[10] + x[ 6], 7);\n            x[ 2] ^= R(x[14] + x[10], 9);\n            x[ 6] ^= R(x[ 2] + x[14], 13);\n            x[10] ^= R(x[ 6] + x[ 2], 18);\n            x[ 3] ^= R(x[15] + x[11], 7);\n            x[ 7] ^= R(x[ 3] + x[15], 9);\n            x[11] ^= R(x[ 7] + x[ 3], 13);\n            x[15] ^= R(x[11] + x[ 7], 18);\n            x[ 1] ^= R(x[ 0] + x[ 3], 7);\n            x[ 2] ^= R(x[ 1] + x[ 0], 9);\n            x[ 3] ^= R(x[ 2] + x[ 1], 13);\n            x[ 0] ^= R(x[ 3] + x[ 2], 18);\n            x[ 6] ^= R(x[ 5] + x[ 4], 7);\n            x[ 7] ^= R(x[ 6] + x[ 5], 9);\n            x[ 4] ^= R(x[ 7] + x[ 6], 13);\n            x[ 5] ^= R(x[ 4] + x[ 7], 18);\n            x[11] ^= R(x[10] + x[ 9], 7);\n            x[ 8] ^= R(x[11] + x[10], 9);\n            x[ 9] ^= R(x[ 8] + x[11], 13);\n            x[10] ^= R(x[ 9] + x[ 8], 18);\n            x[12] ^= R(x[15] + x[14], 7);\n            x[13] ^= R(x[12] + x[15], 9);\n            x[14] ^= R(x[13] + x[12], 13);\n            x[15] ^= R(x[14] + x[13], 18);\n        }\n\n        for (let i = 0; i < 16; ++i) {\n            B[i] += x[i];\n        }\n    }\n\n    // naive approach... going back to loop unrolling may yield additional performance\n    function blockxor(S, Si, D, len) {\n        for (let i = 0; i < len; i++) {\n            D[i] ^= S[Si + i]\n        }\n    }\n\n    function arraycopy(src, srcPos, dest, destPos, length) {\n        while (length--) {\n            dest[destPos++] = src[srcPos++];\n        }\n    }\n\n    function checkBufferish(o) {\n        if (!o || typeof(o.length) !== 'number') { return false; }\n\n        for (let i = 0; i < o.length; i++) {\n            const v = o[i];\n            if (typeof(v) !== 'number' || v % 1 || v < 0 || v >= 256) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    function ensureInteger(value, name) {\n        if (typeof(value) !== \"number\" || (value % 1)) { throw new Error('invalid ' + name); }\n        return value;\n    }\n\n    // N = Cpu cost, r = Memory cost, p = parallelization cost\n    // callback(error, progress, key)\n    function _scrypt(password, salt, N, r, p, dkLen, callback) {\n\n        N = ensureInteger(N, 'N');\n        r = ensureInteger(r, 'r');\n        p = ensureInteger(p, 'p');\n\n        dkLen = ensureInteger(dkLen, 'dkLen');\n\n        if (N === 0 || (N & (N - 1)) !== 0) { throw new Error('N must be power of 2'); }\n\n        if (N > MAX_VALUE / 128 / r) { throw new Error('N too large'); }\n        if (r > MAX_VALUE / 128 / p) { throw new Error('r too large'); }\n\n        if (!checkBufferish(password)) {\n            throw new Error('password must be an array or buffer');\n        }\n        password = Array.prototype.slice.call(password);\n\n        if (!checkBufferish(salt)) {\n            throw new Error('salt must be an array or buffer');\n        }\n        salt = Array.prototype.slice.call(salt);\n\n        let b = PBKDF2_HMAC_SHA256_OneIter(password, salt, p * 128 * r);\n        const B = new Uint32Array(p * 32 * r)\n        for (let i = 0; i < B.length; i++) {\n            const j = i * 4;\n            B[i] = ((b[j + 3] & 0xff) << 24) |\n                   ((b[j + 2] & 0xff) << 16) |\n                   ((b[j + 1] & 0xff) << 8) |\n                   ((b[j + 0] & 0xff) << 0);\n        }\n\n        const XY = new Uint32Array(64 * r);\n        const V = new Uint32Array(32 * r * N);\n\n        const Yi = 32 * r;\n\n        // scratch space\n        const x = new Uint32Array(16);       // salsa20_8\n        const _X = new Uint32Array(16);      // blockmix_salsa8\n\n        const totalOps = p * N * 2;\n        let currentOp = 0;\n        let lastPercent10 = null;\n\n        // Set this to true to abandon the scrypt on the next step\n        let stop = false;\n\n        // State information\n        let state = 0;\n        let i0 = 0, i1;\n        let Bi;\n\n        // How many blockmix_salsa8 can we do per step?\n        const limit = callback ? parseInt(1000 / r): 0xffffffff;\n\n        // Trick from scrypt-async; if there is a setImmediate shim in place, use it\n        const nextTick = (typeof(setImmediate) !== 'undefined') ? setImmediate : setTimeout;\n\n        // This is really all I changed; making scryptsy a state machine so we occasionally\n        // stop and give other evnts on the evnt loop a chance to run. ~RicMoo\n        const incrementalSMix = function() {\n            if (stop) {\n                return callback(new Error('cancelled'), currentOp / totalOps);\n            }\n\n            let steps;\n\n            switch (state) {\n                case 0:\n                    // for (var i = 0; i < p; i++)...\n                    Bi = i0 * 32 * r;\n\n                    arraycopy(B, Bi, XY, 0, Yi);                       // ROMix - 1\n\n                    state = 1;                                         // Move to ROMix 2\n                    i1 = 0;\n\n                    // Fall through\n\n                case 1:\n\n                    // Run up to 1000 steps of the first inner smix loop\n                    steps = N - i1;\n                    if (steps > limit) { steps = limit; }\n                    for (let i = 0; i < steps; i++) {                  // ROMix - 2\n                        arraycopy(XY, 0, V, (i1 + i) * Yi, Yi)         // ROMix - 3\n                        blockmix_salsa8(XY, Yi, r, x, _X);             // ROMix - 4\n                    }\n\n                    // for (var i = 0; i < N; i++)\n                    i1 += steps;\n                    currentOp += steps;\n\n                    if (callback) {\n                        // Call the callback with the progress (optionally stopping us)\n                        const percent10 = parseInt(1000 * currentOp / totalOps);\n                        if (percent10 !== lastPercent10) {\n                            stop = callback(null, currentOp / totalOps);\n                            if (stop) { break; }\n                            lastPercent10 = percent10;\n                        }\n                    }\n\n                    if (i1 < N) { break; }\n\n                    i1 = 0;                                          // Move to ROMix 6\n                    state = 2;\n\n                    // Fall through\n\n                case 2:\n\n                    // Run up to 1000 steps of the second inner smix loop\n                    steps = N - i1;\n                    if (steps > limit) { steps = limit; }\n                    for (let i = 0; i < steps; i++) {                // ROMix - 6\n                        const offset = (2 * r - 1) * 16;             // ROMix - 7\n                        const j = XY[offset] & (N - 1);\n                        blockxor(V, j * Yi, XY, Yi);                 // ROMix - 8 (inner)\n                        blockmix_salsa8(XY, Yi, r, x, _X);           // ROMix - 9 (outer)\n                    }\n\n                    // for (var i = 0; i < N; i++)...\n                    i1 += steps;\n                    currentOp += steps;\n\n                    // Call the callback with the progress (optionally stopping us)\n                    if (callback) {\n                        const percent10 = parseInt(1000 * currentOp / totalOps);\n                        if (percent10 !== lastPercent10) {\n                            stop = callback(null, currentOp / totalOps);\n                            if (stop) { break; }\n                            lastPercent10 = percent10;\n                        }\n                    }\n\n                    if (i1 < N) { break; }\n\n                    arraycopy(XY, 0, B, Bi, Yi);                     // ROMix - 10\n\n                    // for (var i = 0; i < p; i++)...\n                    i0++;\n                    if (i0 < p) {\n                        state = 0;\n                        break;\n                    }\n\n                    b = [];\n                    for (let i = 0; i < B.length; i++) {\n                        b.push((B[i] >>  0) & 0xff);\n                        b.push((B[i] >>  8) & 0xff);\n                        b.push((B[i] >> 16) & 0xff);\n                        b.push((B[i] >> 24) & 0xff);\n                    }\n\n                    const derivedKey = PBKDF2_HMAC_SHA256_OneIter(password, b, dkLen);\n\n                    // Send the result to the callback\n                    if (callback) { callback(null, 1.0, derivedKey); }\n\n                    // Done; don't break (which would reschedule)\n                    return derivedKey;\n            }\n\n            // Schedule the next steps\n            if (callback) { nextTick(incrementalSMix); }\n        }\n\n        // Run the smix state machine until completion\n        if (!callback) {\n            while (true) {\n                const derivedKey = incrementalSMix();\n                if (derivedKey != undefined) { return derivedKey; }\n            }\n        }\n\n        // Bootstrap the async incremental smix\n        incrementalSMix();\n    }\n\n    const lib = {\n        scrypt: function(password, salt, N, r, p, dkLen, progressCallback) {\n            return new Promise(function(resolve, reject) {\n                let lastProgress = 0;\n                if (progressCallback) { progressCallback(0); }\n                _scrypt(password, salt, N, r, p, dkLen, function(error, progress, key) {\n                    if (error) {\n                        reject(error);\n                    } else if (key) {\n                        if (progressCallback && lastProgress !== 1) {\n                            progressCallback(1);\n                        }\n                        resolve(new Uint8Array(key));\n                    } else if (progressCallback && progress !== lastProgress) {\n                        lastProgress = progress;\n                        return progressCallback(progress);\n                    }\n                });\n            });\n        },\n        syncScrypt: function(password, salt, N, r, p, dkLen) {\n            return new Uint8Array(_scrypt(password, salt, N, r, p, dkLen));\n        }\n    };\n\n    // node.js\n    if (typeof(exports) !== 'undefined') {\n       module.exports = lib;\n\n    // RequireJS/AMD\n    // http://www.requirejs.org/docs/api.html\n    // https://github.com/amdjs/amdjs-api/wiki/AMD\n    } else if (typeof(define) === 'function' && define.amd) {\n        define(lib);\n\n    // Web Browsers\n    } else if (root) {\n\n        // If there was an existing library \"scrypt\", make sure it is still available\n        if (root.scrypt) {\n            root._scrypt = root.scrypt;\n        }\n\n        root.scrypt = lib;\n    }\n\n})(this);\n", "const hexTable = new Array(256);\r\nfor (let i = 0; i < 256; i++) {\r\n    hexTable[i] = i.toString(16).padStart(2, '0');\r\n}\r\n\r\n/**\r\n * @param {Uint8Array} data\r\n * @returns {string}\r\n */\r\nexport function hexlify(data) {\r\n    if (!data || !(data instanceof Uint8Array)) {\r\n        throw new TypeError(\"Input must be a Uint8Array\");\r\n    }\r\n    const length = data.length;\r\n    const arr = new Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n        arr[i] = hexTable[data[i]];\r\n    }\r\n    return arr.join('');\r\n}\r\n\r\nconst throwing = {\r\n    get InvalidHexStringException() {\r\n        throw new TypeError('Invalid hex string');\r\n    },\r\n}\r\n\r\n/**\r\n * @param {string} hexStr\r\n * @returns {Uint8Array}\r\n */\r\nexport function unhexlify(hexStr) {\r\n    if (typeof hexStr !== 'string') {\r\n        throw new TypeError(\"Input must be a string\");\r\n    }\r\n    const length = hexStr.length;\r\n    if (length % 2 !== 0) {\r\n        throw new TypeError(\"Hex string must have even length\");\r\n    }\r\n    hexStr = hexStr.toLowerCase();\r\n    const bytes = new Uint8Array(length >> 1);\r\n    for (let i = 0; i < length; i += 2) {\r\n        const highCode = hexStr.charCodeAt(i);\r\n        const lowCode = hexStr.charCodeAt(i + 1);\r\n\r\n        const high = highCode >= 97 && highCode <= 102 ? highCode - 87 :\r\n            highCode >= 48 && highCode <= 57 ? highCode - 48 : throwing.InvalidHexStringException;\r\n        const low = lowCode >= 97 && lowCode <= 102 ? lowCode - 87 :\r\n            lowCode >= 48 && lowCode <= 57 ? lowCode - 48 : throwing.InvalidHexStringException;\r\n\r\n        // @ts-ignore\r\n        bytes[i >> 1] = (high << 4) | low;\r\n    }\r\n    return bytes;\r\n}", "const crypto = globalThis.crypto; // To avoid the possible security risk\r\n\r\n/**\r\n * @param {number} count\r\n */\r\nexport function get_random_bytes(count) {\r\n    const randomBytes = new Uint8Array(count);\r\n    crypto.getRandomValues(randomBytes);\r\n    return randomBytes;\r\n}\r\nexport function get_random_int8_number() {\r\n    const randomBytes = get_random_bytes(1);\r\n    return new Int8Array(randomBytes)[0];\r\n}\r\nexport function get_random_uint8_number() {\r\n    const randomBytes = get_random_bytes(1);\r\n    return new Uint8Array(randomBytes)[0];\r\n}", "/**\r\n * @param {string} input\r\n */\r\nexport function str_encode(input, encoding = \"utf-8\") {\r\n    if (typeof input !== \"string\") {\r\n        throw new TypeError(\"Input must be a string\");\r\n    }\r\n    if (encoding.toLowerCase() !== \"utf-8\") {\r\n        throw new Error(\"Only 'utf-8' encoding is supported\");\r\n    }\r\n    return new TextEncoder().encode(input);\r\n}\r\n/**\r\n * @param {Uint8Array|ArrayBuffer} input\r\n */\r\nexport function str_decode(input, encoding = \"utf-8\") {\r\n    if (!(input instanceof Uint8Array)) {\r\n        input = new Uint8Array(input);\r\n    }\r\n    if (encoding.toLowerCase() !== \"utf-8\") {\r\n        throw new Error(\"Only 'utf-8' encoding is supported\");\r\n    }\r\n    return new TextDecoder().decode(input);\r\n}", "// Base Exception Class.\r\nexport class LibraryError extends Error {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'Library Error', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'LibraryError';\r\n    }\r\n}\r\n\r\n/**\r\n * @param {any} error\r\n * @returns {never}\r\n */\r\nexport function raise(error) {\r\n    throw error; \r\n}\r\n\r\n// Level 1\r\n\r\nexport class EncryptionError extends LibraryError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'Encryption Error', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'EncryptionError';\r\n    }\r\n}\r\n\r\nexport class NetworkError extends LibraryError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = '(Network Error)', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'NetworkError';\r\n    }\r\n}\r\n\r\n// Level 2\r\n\r\nexport class ExpectedError extends EncryptionError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = '(Expected Error)', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'ExpectedError';\r\n    }\r\n}\r\n\r\nexport class RuntimeException extends EncryptionError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = '(Runtime Error)', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'RuntimeException';\r\n    }\r\n}\r\n\r\nexport class UnexpectedError extends RuntimeException {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = '(Unexpected Error)', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'UnexpectedError';\r\n    }\r\n}\r\n\r\nexport class InternalError extends UnexpectedError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = '(Internal Error)', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InternalError';\r\n    }\r\n}\r\n\r\nexport class InputError extends RuntimeException {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = '(Input Error)', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InputError';\r\n    }\r\n}\r\n\r\nexport class ParameterError extends InputError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = '(Data Error)', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'ParameterError';\r\n    }\r\n}\r\n\r\nexport class DataError extends InputError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = '(Data Error)', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'DataError';\r\n    }\r\n}\r\n\r\nexport class UserException extends RuntimeException {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = '(The end user has a fault that caused the exception. This is not code bug.)', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'UserException';\r\n    }\r\n}\r\n\r\n// Level 3\r\n\r\nexport class VersionSystemError extends DataError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = '(Version System Error)', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'VersionSystemError';\r\n    }\r\n}\r\n\r\n// Level 4 -- Detailed Errors\r\n\r\nexport class InvalidParameterException extends ParameterError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'The parameter provided is invalid.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InvalidParameterException';\r\n    }\r\n}\r\n\r\nexport class BadDataException extends DataError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'The data is bad.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'BadDataException';\r\n    }\r\n}\r\n\r\nexport class InvalidScryptParameterException extends ParameterError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'The N, r, or p is not valid or out of range.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InvalidScryptParameterException';\r\n    }\r\n}\r\n\r\nexport class EncryptionVersionMismatchException extends VersionSystemError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'The version of the encryption library doesn\\'t match.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'EncryptionVersionMismatchException';\r\n    }\r\n}\r\n\r\nexport class InvalidFileFormatException extends DataError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'The file format is invalid.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InvalidFileFormatException';\r\n    }\r\n}\r\n\r\nexport class IVException extends InternalError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'IV Exception.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'IVException';\r\n    }\r\n}\r\n\r\nexport class FileCorruptedException extends DataError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'File is corrupted.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'FileCorruptedException';\r\n    }\r\n}\r\n\r\nexport class InvalidEndMarkerException extends DataError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'The end marker is invalid.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InvalidEndMarkerException';\r\n    }\r\n}\r\n\r\nexport class CannotDecryptException extends UserException {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'Cannot decrypt', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'CannotDecryptException';\r\n    }\r\n}\r\n\r\nexport class UnexpectedFailureInChunkDecryptionException extends UnexpectedError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'An unexpected failure occurred while decrypting the chunk. The file may be corrupted.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'UnexpectedFailureInChunkDecryptionException';\r\n    }\r\n}\r\n\r\nexport class CryptContextReusedException extends ParameterError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'Not allowed to reuse a crypt context.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'CryptContextReusedException';\r\n    }\r\n}\r\n\r\nexport class NotSupportedException extends InputError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'Operation not supported', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'NotSupportedException';\r\n    }\r\n}\r\n\r\nexport class DeprecationException extends InputError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'Trying to use a deprecated feature.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'DeprecationException';\r\n    }\r\n}\r\n\r\n/**\r\n * @deprecated No longer use exceptions to change control flow. Now we return empty blob with {eof: true} to indicate the end of file.\r\n */\r\nexport class EndOfFileException extends ExpectedError {\r\n    constructor(message = 'End of File', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'EndOfFileException';\r\n        // @ts-ignore\r\n        if (typeof process !== 'undefined' && process?.env?.NODE_ENV === 'production') return;\r\n        globalThis.console.warn('%c[npm::simple-data-crypto] %c[EndOfFileException] %cDEPRECATED!! %cDeprecated and will be removed in the next MAJOR version. See %csrc/exceptions.js%c for more information.\\n' +\r\n            '%cNote: %cThis %cdoes not%c indicate the package is deprecated. Instead, it indicates that your code uses the %cdeprecated%c class %cEndOfFileException%c. Fix your code to suppress this warning.',\r\n            'color: #007700', 'color: #570263', 'color: red; font-weight: bold;', '', 'font-weight: bold;', '', 'font-weight: bold; color: #0000ff', '',\r\n            'color: red; font-weight: bold;', '', 'font-style: italic', '', 'color: #570263', '');\r\n    }\r\n}\r\n\r\nexport class CryptContextNotInitedException extends ParameterError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'Crypt context is not initialized.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'CryptContextNotInitedException';\r\n    }\r\n}\r\n\r\nexport class InvalidCryptContextTypeException extends ParameterError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'Invalid crypt context type.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InvalidCryptContextTypeException';\r\n    }\r\n}\r\n\r\nexport class CryptContextReleasedException extends ParameterError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'Crypt context has been released.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'CryptContextReleasedException';\r\n    }\r\n}\r\n\r\nexport class OperationNotPermittedException extends ParameterError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'Operation not permitted.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'OperationNotPermittedException';\r\n    }\r\n}\r\n\r\nexport class EncryptionAlgorithmNotSupportedException extends DataError {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'The specified encryption algorithm is not supported.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'EncryptionAlgorithmNotSupportedException';\r\n    }\r\n}\r\n\r\nexport class ChaCha20NotSupportedException extends EncryptionAlgorithmNotSupportedException {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'ChaCha20 is not supported yet.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'ChaCha20NotSupportedException';\r\n    }\r\n}\r\n\r\nexport class DangerousEncryptionAlgorithmException extends EncryptionAlgorithmNotSupportedException {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'The specified encryption algorithm is DANGEROUS.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'DangerousEncryptionAlgorithmException';\r\n    }\r\n}\r\n\r\n/**\r\n * 0xC000041D STATUS_CALLBACK_UNHANDLED_EXCEPTION\r\n * An unhandled exception was encountered during a user callback...\r\n */\r\nexport class UnhandledExceptionInUserCallback extends RuntimeException {\r\n    /**\r\n     * @param {string} message \r\n     * @param {Object} [additional] \r\n     */\r\n    constructor(message = 'An unhandled exception was encountered during a user callback.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'UnhandledExceptionInUserCallback';\r\n    }\r\n}\r\n", "// @ts-ignore\r\nimport { scrypt as s } from 'scrypt-js';\r\n\r\nexport function scrypt(key, salt, N, r, p, dklen, onprogress = null) {\r\n    return s(key, salt, N, r, p, dklen, (onprogress ? ((progress) => {\r\n        onprogress(progress);\r\n    }) : undefined));\r\n}", "import * as Exceptions from \"./exceptions.js\";\r\nimport { str_decode } from \"./str.js\";\r\n\r\nexport const PADDING_SIZE = 4096; // 4096 bytes\r\nexport const END_IDENTIFIER = [\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n];\r\nexport const TAIL_BLOCK_MARKER = [\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n    0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55,\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n    0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55,\r\n];\r\nexport const END_MARKER = [\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n];\r\nexport const FILE_END_MARKER = [0xFF, 0xFD, 0xF0, 0x10, 0x13, 0xD0, 0x12, 0x18, 0x55, 0xAA];\r\nexport const POWER_2_64 = 2n ** 64n;\r\nif (POWER_2_64 !== BigInt('18446744073709551616')) {\r\n    throw new Exceptions.UnexpectedError('POWER_2_64 is not 2^64');\r\n}\r\n\r\n// @ts-ignore\r\nconst timerproc = (typeof process === 'undefined') ?\r\n    requestAnimationFrame : // browser\r\n    setTimeout; // node.js\r\nexport function nextTick() {\r\n    return new Promise(r => timerproc(r));\r\n}\r\n\r\n/**\r\n * @param {string} major_version\r\n * @param {number|null} version_marker\r\n */\r\nexport function normalize_version(major_version, version_marker = null) {\r\n    if (!major_version) return `Unknown Version`;\r\n    let vm = String(version_marker);\r\n    if (String(major_version) === '1.1') vm = 'null';\r\n    if (!version_marker) return `${major_version}/0`;\r\n    return `${major_version}/${vm}`;\r\n}\r\n\r\n// versions\r\nexport const ENCRYPTION_FILE_VER_1_1_0 = normalize_version('1.1');\r\nexport const ENCRYPTION_FILE_VER_1_2_10020 = normalize_version('1.2', 10020);\r\n\r\n\r\n/**\r\n * @param {(start: number, end: number) => Promise<Uint8Array>} file_reader - \u6587\u4EF6\u8BFB\u53D6\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0(start: number, end: number) => Promise<Uint8Array>\r\n */\r\nexport async function GetFileVersion(file_reader) {\r\n    // \u8BFB\u53D6\u6587\u4EF6\u5934\u5E76\u9A8C\u8BC1\r\n    const header = await file_reader(0, 13);\r\n    if (str_decode(header) !== 'MyEncryption/') {\r\n        throw new Exceptions.InvalidFileFormatException();\r\n    }\r\n    const top_header_version = (str_decode(await file_reader(13, 16)));\r\n    if(!(['1.1', '1.2'].includes(top_header_version))) {\r\n        throw new Exceptions.EncryptionVersionMismatchException();\r\n    }\r\n    const version_marker = new DataView((await file_reader(16, 20)).buffer).getUint32(0, true);\r\n    const version = normalize_version(top_header_version, version_marker);\r\n    return version;\r\n}\r\n\r\n/**\r\n * @param {(start: number, end: number) => Promise<Uint8Array>} file_reader - \u6587\u4EF6\u8BFB\u53D6\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0(start: number, end: number) => Promise<Uint8Array>\r\n */\r\nexport async function GetFileInfo(file_reader) {\r\n    const version = await GetFileVersion(file_reader);\r\n    if (version === ENCRYPTION_FILE_VER_1_1_0) {\r\n        throw new Exceptions.OperationNotPermittedException('The chunk size is volatile and we cannot get a fixed value.');\r\n    }\r\n    if (version === ENCRYPTION_FILE_VER_1_2_10020) {\r\n        let read_pos = 16 + 4;\r\n        const ekey_len = new DataView((await file_reader(read_pos, read_pos + 4)).buffer).getUint32(0, true);\r\n        const ekey = str_decode(await file_reader(read_pos + 4, read_pos + 4 + ekey_len));\r\n        read_pos += PADDING_SIZE;\r\n        const json_len_bytes = await file_reader(read_pos, read_pos + 4);\r\n        const json_len = new DataView(json_len_bytes.buffer).getUint32(0, true);\r\n        read_pos += 4;\r\n        read_pos += json_len;\r\n        const chunk_size = Number(new DataView((await file_reader(read_pos, read_pos + 8)).buffer).getBigUint64(0, true));\r\n        let nonce_counter = Number(new DataView((await file_reader(read_pos + 8, read_pos + 16)).buffer).getBigUint64(0, true));\r\n        return ({ version, chunk_size, nonce_counter, ekey });\r\n    }\r\n    throw new Exceptions.EncryptionVersionMismatchException();\r\n}\r\n\r\n/**\r\n * @param {(start: number, end: number) => Promise<Uint8Array>} file_reader\r\n */\r\nexport async function GetFileChunkSize(file_reader) {\r\n    return (await GetFileInfo(file_reader)).chunk_size;\r\n}\r\n\r\n/**\r\n * @param {string} algorithm\r\n */\r\nexport function CheckAlgorithm(algorithm) {\r\n    // \u5224\u65AD\u662F\u5426\u652F\u6301\u7684\u52A0\u5BC6\u7B97\u6CD5\r\n    // \u9ED8\u8BA4\u662FAES-GCM\r\n    if ((!!algorithm) && (algorithm !== \"AES-GCM\")) {\r\n        if (algorithm === 'ChaCha20' || algorithm === 'ChaCha20-Poly1305') {\r\n            throw new Exceptions.ChaCha20NotSupportedException();\r\n        }\r\n        if (algorithm === 'DES' || algorithm === 'RC4') {\r\n            throw new Exceptions.DangerousEncryptionAlgorithmException();\r\n        }\r\n        if (algorithm === 'XTS-AES') {\r\n            throw new Exceptions.EncryptionAlgorithmNotSupportedException(\"XTS-AES is not supported yet\");\r\n        }\r\n        throw new Exceptions.EncryptionAlgorithmNotSupportedException(undefined, {\r\n            cause: new Error(String(algorithm))\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * @param {string} message\r\n */\r\nexport async function is_encrypted_message(message) {\r\n    if (typeof message !== 'string') return false;\r\n    \r\n    if (message.charAt(0) === ':') {\r\n        const arr = message.split(':');\r\n        if (arr.length === 8) {\r\n            const [, data, phrase, salt, N, v, a,] = arr;\r\n            return !!(data && phrase && salt && N && v && a);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    if (message.charAt(0) !== '{') return false;\r\n\r\n    try {\r\n        const json = JSON.parse(message);\r\n        return (json.data && json.parameter && json.N && json.v); \r\n    }\r\n    catch {\r\n        return false; \r\n    }\r\n}\r\n\r\n/**\r\n * @param {(start: number, end: number) => Promise<Uint8Array>} file_reader - \u6587\u4EF6\u8BFB\u53D6\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0(start: number, end: number) => Promise<Uint8Array>\r\n */\r\nexport async function is_encrypted_file(file_reader) {\r\n    try {\r\n        const info = await GetFileInfo(file_reader);\r\n        return !!info.version;\r\n    }\r\n    catch {\r\n        return false; \r\n    }\r\n}\r\n\r\n/**\r\n * Ensures that the Uint8Array's buffer is safe to use.\r\n * @param {Uint8Array} data \r\n * @returns {Uint8Array}\r\n */\r\nexport function toSafeUint8Array(data) {\r\n    if (data.buffer instanceof SharedArrayBuffer) \r\n        return new Uint8Array(data.slice());\r\n    else\r\n        return data;\r\n}\r\n", "import { get_random_bytes } from \"./random.js\";\r\nimport { derive_key } from \"./derive_key.js\";\r\nimport { hexlify, unhexlify } from \"./binascii.js\";\r\nimport { str_decode, str_encode } from \"./str.js\";\r\nimport * as Exceptions from './exceptions.js';\r\nimport { CheckAlgorithm } from \"./internal-util.js\";\r\n\r\nconst crypto = globalThis.crypto; // To avoid the possible security risk\r\n\r\n/**\r\n * @param {string} json\r\n */\r\nfunction safeparse(json) {\r\n    try {\r\n        const r = JSON.parse(json);\r\n        if (!r || !r.data || !r.parameter || !r.N || !r.v) throw new Exceptions.BadDataException('The message is bad since the JSON is not complete.');\r\n        return r;\r\n    } catch {\r\n        throw new Exceptions.BadDataException('The message is bad since it is neither a JSON or a new-format ciphertext.');\r\n    }\r\n}\r\n\r\n/**\r\n * @param {string} message\r\n * @param {string} key\r\n * @param {?string} phrase phrase\r\n * @param {?number} N N\r\n */\r\nexport async function encrypt_data(message, key, phrase = null, N = null) {\r\n    // (1) \u751F\u6210\u968F\u673AIV (12 bytes for GCM)\r\n    const iv = get_random_bytes(12);\r\n\r\n    // (2) \u6D3E\u751F\u5BC6\u94A5\r\n    const { derived_key, parameter, N: N2 } = await derive_key(key, iv, phrase, N);\r\n    N = N2;\r\n\r\n    // (3) \u5BFC\u5165\u5BC6\u94A5\r\n    const cipher = await crypto.subtle.importKey(\"raw\", derived_key, \"AES-GCM\", false, [\"encrypt\"]);\r\n\r\n    if (typeof message !== \"string\") {\r\n        // @ts-ignore\r\n        if (message && (message instanceof ArrayBuffer || message instanceof Uint8Array)) throw new Exceptions.OperationNotPermittedException(\"The ability to directly encrypt binary data has been removed in the new version. Please use `encrypt_file` instead.\");\r\n        throw new Exceptions.InvalidParameterException(\"The message must be a string.\");\r\n    }\r\n\r\n    const alg = \"AES-GCM\";\r\n\r\n    // (4) \u52A0\u5BC6\u6D88\u606F\r\n    const ciphertext = await crypto.subtle.encrypt(\r\n        {\r\n            name: alg,\r\n            iv: iv\r\n        },\r\n        cipher,\r\n        str_encode(message)\r\n    );\r\n\r\n    // \u7EC4\u5408IV + \u5BC6\u6587 + \u8BA4\u8BC1\u6807\u7B7E\r\n    const encrypted_message = new Uint8Array(iv.length + ciphertext.byteLength);\r\n    encrypted_message.set(iv, 0);\r\n    encrypted_message.set(new Uint8Array(ciphertext), iv.length);\r\n    const message_encrypted = hexlify(encrypted_message);\r\n\r\n    const v = 5.6;\r\n\r\n    // \u8FD4\u56DE\u6570\u636E\r\n    return `:${message_encrypted}:${parameter}:${N}:${v}:${alg}:`;\r\n}\r\n\r\n\r\n/**\r\n * @param {string} message_encrypted\r\n */\r\nexport async function parse_ciphertext(message_encrypted) {\r\n    if (typeof message_encrypted !== \"string\") throw new Exceptions.InvalidParameterException(\"The message is not a string.\");\r\n    let jsoned;\r\n    if (message_encrypted.charAt(0) === ':') {\r\n        const arr = message_encrypted.split(':');\r\n        if (arr.length !== 8) throw new Exceptions.BadDataException('The message is bad.');\r\n        const [, data, phrase, salt, N, v, a,] = arr;\r\n        jsoned = { data, phrase, salt, N: +N, v: +v, a };\r\n    } else {\r\n        jsoned = safeparse(message_encrypted);\r\n    }\r\n    const N = parseInt(jsoned.N);\r\n    const alg = jsoned.a;\r\n    CheckAlgorithm(alg);\r\n\r\n    // \u5C06\u5341\u516D\u8FDB\u5236\u5B57\u7B26\u4E32\u8F6C\u6362\u56DE\u5B57\u8282\r\n    const encrypted_data = unhexlify(jsoned.data);\r\n    let phrase, salt_b64;\r\n    if (jsoned.parameter) [phrase, salt_b64] = jsoned.parameter.split(':');\r\n    else {\r\n        phrase = jsoned.phrase; salt_b64 = jsoned.salt;\r\n    }\r\n    const salt = unhexlify(salt_b64);\r\n\r\n    if (isNaN(N) || !phrase || ('string' !== typeof phrase) || !encrypted_data || !salt)\r\n        throw new Exceptions.BadDataException('The message or parameters are bad.')\r\n    if (encrypted_data.length < 28)\r\n        throw new Exceptions.BadDataException(\"The message was too short.\");\r\n\r\n    // \u63D0\u53D6 IV (\u524D12\u5B57\u8282)\u3001\u5BC6\u6587\u548C\u8BA4\u8BC1\u6807\u7B7E(\u6700\u540E16\u5B57\u8282)\r\n    const iv = encrypted_data.slice(0, 12);\r\n    const ciphertext = encrypted_data.slice(12, -16);\r\n    const tag = encrypted_data.slice(-16);\r\n\r\n    return { iv, ciphertext, tag, phrase, salt, N };\r\n}\r\n\r\n/**\r\n * @param {string} message_encrypted\r\n * @param {string|Uint8Array<ArrayBuffer>} key\r\n */\r\nexport async function decrypt_data(message_encrypted, key) {\r\n    const { iv, ciphertext, tag, phrase, salt, N } = await parse_ciphertext(message_encrypted);\r\n\r\n    const derived_key = (typeof key === \"string\") ?\r\n        ((await derive_key(key, iv, phrase, N, salt)).derived_key) :\r\n        (key);\r\n    if (!(derived_key instanceof Uint8Array)) throw new Exceptions.InvalidParameterException(\"The key is not valid.\");\r\n\r\n    const cipher = await crypto.subtle.importKey(\"raw\", derived_key, \"AES-GCM\", false, [\"decrypt\"]);\r\n\r\n    try {\r\n        const decrypted_data = await crypto.subtle.decrypt(\r\n            {\r\n                name: \"AES-GCM\",\r\n                iv: iv,\r\n            },\r\n            cipher,\r\n            new Uint8Array([...ciphertext, ...tag])\r\n        );\r\n\r\n        try {\r\n            return str_decode(decrypted_data);\r\n        } catch {\r\n            throw new Exceptions.OperationNotPermittedException(\"The ability to directly decrypt binary data has been removed in the new version. If you have encrypted binary data, please recover it using the old version.\");\r\n        }\r\n    }\r\n    catch (e) {\r\n        if (!e || !(e instanceof DOMException)) throw new Exceptions.InternalError(`Internal error.`, { cause: e });\r\n        const name = e.name;\r\n        if (name === 'InvalidAccessError') throw new Exceptions.InvalidParameterException('InvalidAccessError.', { cause: e });\r\n        if (name === 'OperationError') throw new Exceptions.CannotDecryptException('Cannot decrypt. Did you provide the correct password?', { cause: e });\r\n        throw new Exceptions.InternalError(`Unexpected error.`, { cause: e });\r\n    }\r\n}\r\n\r\n", "import { hexlify, unhexlify } from \"./binascii.js\";\r\nimport { get_random_bytes, get_random_uint8_number } from \"./random.js\";\r\nimport { str_decode, str_encode } from \"./str.js\";\r\nimport * as Exceptions from './exceptions.js';\r\nimport { scrypt } from './scrypt-layer/entrance.js';\r\nimport { decrypt_data } from \"./encrypt_data.js\";\r\nimport { GetFileVersion, ENCRYPTION_FILE_VER_1_1_0, PADDING_SIZE, CheckAlgorithm, ENCRYPTION_FILE_VER_1_2_10020 } from \"./internal-util.js\";\r\n\r\nexport const deriveKey__phrases = ['Elysia', 'Kiana', 'Raiden', 'Bronya', 'Seele', 'Kevin', 'Cyrene', 'Furina', 'Neuvillette', 'Venti', 'Nahida', 'Kinich', 'Kazuha'];\r\n/**\r\n * Derive a key from a phrase and a key.\r\n * @param {string} key \r\n * @param {Uint8Array} iv \r\n * @param {?string} phrase \r\n * @param {?number} N \r\n * @param {?Uint8Array} salt \r\n * @param {number} r \r\n * @param {number} p \r\n * @param {number} dklen \r\n */\r\nexport async function derive_key(key, iv, phrase = null, N = null, salt = null, r = 8, p = 1, dklen = 32) {\r\n    if (!N) N = 262144;\r\n    // const Is_N_power_2 = (N & (N - 1)) === 0;\r\n    if (typeof N !== \"number\" || N > 4194304 || r < 1 || p < 1 || typeof r !== \"number\" || typeof p !== \"number\" || typeof dklen !== \"number\" || (!((N & (N - 1)) === 0))) {\r\n        throw new Exceptions.InvalidScryptParameterException();\r\n    }\r\n    if (typeof key !== \"string\") throw new Exceptions.InvalidParameterException(\"key must be a string\");\r\n    if (!(iv instanceof Uint8Array)) throw new Exceptions.InvalidParameterException(\"iv must be a Uint8Array\");\r\n    if (phrase !== null && typeof phrase !== \"string\") throw new Exceptions.InvalidParameterException(\"phrase must be a string\");\r\n\r\n    // (2) \u751F\u6210salt\r\n    if (!salt) {\r\n        salt = get_random_bytes(64);\r\n    }\r\n\r\n    // \u5904\u7406phrase\r\n    if (!phrase) {\r\n        phrase = deriveKey__phrases[(get_random_uint8_number()) % deriveKey__phrases.length];\r\n    }\r\n    if (phrase.includes(\":\")) {\r\n        throw new Exceptions.InvalidParameterException(\"phrase must not contain \\\":\\\"\");\r\n    }\r\n\r\n    const parameter = `${phrase}:${hexlify(salt)}`;\r\n\r\n    // (3) \u751F\u6210\u52A0\u5BC6\u5BC6\u94A5\r\n    const keyInput = `MyEncryption/1.1 Fontaine/4.2 Iv/${hexlify(iv)} user_parameter=${parameter} user_key=${key}`;\r\n\r\n    // \u4F7F\u7528Scrypt\u8FDB\u884C\u5BC6\u94A5\u6D3E\u751F(pycryptodome\u6CA1\u6709PBKDF2HMAC\uFF0C\u4F7F\u7528Scrypt\u4F5C\u4E3A\u66FF\u4EE3)\r\n    // AES-256\u9700\u898132\u5B57\u8282\u5BC6\u94A5\r\n    /**\r\n     * @type {Uint8Array<ArrayBuffer>}\r\n     */\r\n    const derived_key = await scrypt(str_encode(keyInput), salt, N, r, p, dklen)\r\n\r\n    return ({ derived_key, parameter, N });\r\n}\r\n\r\n\r\n/**\r\n * Derive a key for a file.\r\n * @param {(start: number, end: number) => Promise<Uint8Array>} file_reader \r\n * @param {string} user_key \r\n */\r\nexport async function derive_key_for_file(file_reader, user_key) {\r\n    let read_pos = 16 + 4;\r\n    const version = await GetFileVersion(file_reader);\r\n\r\n    if (version === ENCRYPTION_FILE_VER_1_1_0) {\r\n        throw new Exceptions.NotSupportedException(\"Deriving a key for V1.1 files is not supported\");\r\n    }\r\n    if (version !== ENCRYPTION_FILE_VER_1_2_10020) {\r\n        throw new Exceptions.EncryptionVersionMismatchException();\r\n    }\r\n\r\n    const ekey_len = new DataView((await file_reader(read_pos, read_pos + 4)).buffer).getUint32(0, true);\r\n    const ekey = str_decode(await file_reader(read_pos + 4, read_pos + 4 + ekey_len));\r\n\r\n    read_pos += PADDING_SIZE;\r\n    \r\n    if (ekey_len > PADDING_SIZE) {\r\n        throw new Exceptions.InternalError(\"(Internal Error) This should not happen. Contact the application developer.\");\r\n    }\r\n        \r\n    // \u89E3\u5BC6\u4E3B\u5BC6\u94A5\r\n    const key = await decrypt_data(ekey, user_key);\r\n\r\n    // \u8BFB\u53D6\u5934\u90E8JSON\u957F\u5EA6\r\n    const json_len_bytes = await file_reader(read_pos, read_pos + 4);\r\n    const json_len = new DataView(json_len_bytes.buffer).getUint32(0, true);\r\n    read_pos += 4;\r\n\r\n    // \u89E3\u6790\u5934\u90E8JSON\r\n    const header_json = JSON.parse(\r\n        str_decode(await file_reader(read_pos, read_pos + json_len))\r\n    );\r\n    read_pos += json_len;\r\n\r\n    // \u63D0\u53D6\u6D3E\u751F\u53C2\u6570\r\n    const header_version = header_json.v;\r\n    if (!([5.5].includes(header_version))) throw new Exceptions.EncryptionVersionMismatchException();\r\n    const [phrase, salt_hex] = header_json.parameter.split(':');\r\n    const salt = unhexlify(salt_hex);\r\n    const iv4key = unhexlify(header_json.iv);\r\n    const N = header_json.N;\r\n    const algorithm = header_json.a;\r\n\r\n    // \u5224\u65AD\u662F\u5426\u652F\u6301\u7684\u52A0\u5BC6\u7B97\u6CD5\r\n    CheckAlgorithm(algorithm);\r\n\r\n    return ((await derive_key(key, iv4key, phrase, N, salt)).derived_key);\r\n}\r\n\r\n\r\nexport async function scrypt_hex(key, salt, N, r, p, dklen) {\r\n    return hexlify(await scrypt(str_encode(key), str_encode(salt), N, r, p, dklen));\r\n}\r\n\r\nexport { scrypt };", "import { derive_key } from \"./derive_key.js\";\r\nimport { hexlify, unhexlify } from \"./binascii.js\";\r\nimport { get_random_bytes } from \"./random.js\";\r\nimport { str_encode, str_decode } from \"./str.js\";\r\nimport { encrypt_data, decrypt_data } from \"./encrypt_data.js\";\r\nimport * as Exceptions from './exceptions.js';\r\n\r\nimport {\r\n    normalize_version, ENCRYPTION_FILE_VER_1_1_0, ENCRYPTION_FILE_VER_1_2_10020,\r\n    PADDING_SIZE,\r\n    END_IDENTIFIER, TAIL_BLOCK_MARKER, END_MARKER, FILE_END_MARKER,\r\n    nextTick,\r\n    GetFileVersion,\r\n    CheckAlgorithm,\r\n    POWER_2_64,\r\n} from \"./internal-util.js\";\r\nexport { normalize_version, ENCRYPTION_FILE_VER_1_1_0, ENCRYPTION_FILE_VER_1_2_10020 };\r\n    \r\nconst crypto = globalThis.crypto; // To avoid the possible security risk\r\n\r\n\r\n/**\r\n * \u52A0\u5BC6\u6587\u4EF6\r\n * @param {(start: number, end: number) => Promise<Uint8Array<ArrayBuffer>>} file_reader - \u6587\u4EF6\u8BFB\u53D6\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0(start: number, end: number) => Promise<Uint8Array<ArrayBuffer>>\r\n * @param {(data: Uint8Array<ArrayBuffer>) => Promise<void>} file_writer - \u6587\u4EF6\u5199\u5165\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0write(Uint8Array<ArrayBuffer>)\u65B9\u6CD5\r\n * @param {string} user_key - \u7528\u6237\u5BC6\u94A5\r\n * @param {((processed_bytes: number) => void)|null} callback - \u53EF\u9009\u56DE\u8C03\u51FD\u6570\uFF0C\u7528\u4E8E\u62A5\u544A\u52A0\u5BC6\u8FDB\u5EA6\r\n * @param {string|null} phrase - \u53EF\u9009\u77ED\u8BED\uFF0C\u7528\u4E8E\u5BC6\u94A5\u6D3E\u751F\r\n * @param {number|null} N - scrypt\u53C2\u6570N\r\n * @param {number} chunk_size - \u5206\u5757\u5927\u5C0F\uFF0C\u9ED8\u8BA4\u4E3A32MiB\r\n * @returns {Promise<boolean>} \u8FD4\u56DE\u52A0\u5BC6\u662F\u5426\u6210\u529F\r\n */\r\nexport async function encrypt_file(file_reader, file_writer, user_key, callback = null, phrase = null, N = null, chunk_size = 32 * 1024 * 1024) {\r\n    // fast-fail\r\n    if (typeof file_reader !== 'function' || typeof file_writer !== 'function') {\r\n        throw new Exceptions.InvalidParameterException(\"file_reader and file_writer must be functions\");\r\n    }\r\n    if ((typeof user_key !== 'string')) {\r\n        throw new Exceptions.InvalidParameterException(\"user_key must be a string\");\r\n    }\r\n    if (!chunk_size) throw new Exceptions.InvalidParameterException('chunk_size must be greater than 0.');\r\n    const original_callback = callback;\r\n    callback = (typeof callback === 'function') ? async function UserCallback(progress) {\r\n        try {\r\n            const r = original_callback?.(progress);\r\n            // @ts-ignore\r\n            if ((r) && (r instanceof Promise)) await r;\r\n        } catch (e) {\r\n            throw new Exceptions.UnhandledExceptionInUserCallback('An unhandled exception was encountered during a user callback.', { cause: e });\r\n        }\r\n    } : null;\r\n\r\n    // \u5199\u5165\u6587\u4EF6\u5934\u6807\u8BC6\u548C\u7248\u672C (16\u5B57\u8282)\r\n    await file_writer(str_encode('MyEncryption/1.2'));\r\n\r\n    // \u5199\u5165\u7248\u672C\u6807\u8BC6\u7B26\r\n    const VERSION_MARKER = 10020;\r\n    const versionMarkerBuffer = new ArrayBuffer(4);\r\n    new DataView(versionMarkerBuffer).setUint32(0, VERSION_MARKER, true);\r\n    await file_writer(new Uint8Array(versionMarkerBuffer));\r\n\r\n    // \u4EA7\u751F\u4E3B\u5BC6\u94A5\r\n    const key = hexlify(get_random_bytes(128));\r\n    // N\u5728\u8FD9\u91CC\u88AB\u4F7F\u7528\r\n    const ekey = await encrypt_data(key, user_key, phrase, N);\r\n    const ekey_bytes = str_encode(ekey);\r\n    // \u5BF9\u4E8E128\u5B57\u8282\u7684\u968F\u673A\u4E3B\u5BC6\u94A5\uFF0C\u6211\u4EEC\u5728\u4E0B\u9762\u5B8C\u5168\u6CA1\u6709\u5FC5\u8981\u4F7F\u7528\u8FC7\u9AD8\u7684N\u3002\r\n    N = 8192; // \u964D\u4F4E\u6587\u4EF6\u5185\u5BB9\u7684N\u4EE5\u63D0\u5347\u6027\u80FD\r\n\r\n    // \u68C0\u67E5\u957F\u5EA6\r\n    if (ekey_bytes.length > PADDING_SIZE) {\r\n        throw new Exceptions.InternalError(\"(Internal Error) This should not happen. Contact the application developer.\");\r\n    }\r\n\r\n    // \u5199\u5165\u4E3B\u5BC6\u94A5\u5BC6\u6587\u957F\u5EA6(4\u5B57\u8282)\u548C\u5185\u5BB9\uFF0C\u586B\u5145\u5230PADDING_SIZE\u5B57\u8282\r\n    const lengthBuffer = new ArrayBuffer(4);\r\n    new DataView(lengthBuffer).setUint32(0, ekey_bytes.length, true);\r\n    await file_writer(new Uint8Array(lengthBuffer));\r\n    await file_writer(ekey_bytes);\r\n\r\n    // \u586B\u5145\u5269\u4F59\u7A7A\u95F4\r\n    const padding = new Uint8Array(PADDING_SIZE - ekey_bytes.length - 4).fill(0);\r\n    await file_writer(padding);\r\n\r\n    // \u751F\u6210\u521D\u59CBIV\u7528\u4E8E\u6D3E\u751F\u5BC6\u94A5 (12\u5B57\u8282)\r\n    await callback?.(0); await nextTick();\r\n    const iv_for_key = get_random_bytes(12);\r\n    const { derived_key, parameter, N: N2 } = await derive_key(key, iv_for_key, phrase, N);\r\n    N = N2;\r\n\r\n    // \u51C6\u5907\u5934\u90E8JSON\u6570\u636E\r\n    // \u6CE8\u610F\uFF1A\u5B89\u5168\u6027\u4E3B\u8981\u4F9D\u9760\u4E3B\u5BC6\u94A5\u3002\u5B9E\u9645\u4E0A\u5BF9\u4E8E64\u5B57\u8282\u7684\u968F\u673A\u4E3B\u5BC6\u94A5\u5B8C\u5168\u6CA1\u6709\u5FC5\u8981\u4F7F\u7528\u8FC7\u9AD8\u7684N\u3002\r\n    const header_data = {\r\n        \"parameter\": parameter,\r\n        \"N\": N,\r\n        \"v\": 5.5,\r\n        \"a\": \"AES-GCM\",\r\n        \"iv\": hexlify(iv_for_key)\r\n    };\r\n    const header_json = str_encode(JSON.stringify(header_data));\r\n\r\n    // \u5199\u5165JSON\u957F\u5EA6(4\u5B57\u8282)\u548CJSON\u6570\u636E\r\n    const headerLengthBuffer = new ArrayBuffer(4);\r\n    new DataView(headerLengthBuffer).setUint32(0, header_json.length, true);\r\n    await file_writer(new Uint8Array(headerLengthBuffer));\r\n    await file_writer(header_json);\r\n\r\n    // \u5199\u5165chunk size\u53C2\u6570\r\n    const chunkSizeBuffer = new ArrayBuffer(8);\r\n    new DataView(chunkSizeBuffer).setBigUint64(0, BigInt(chunk_size), true);\r\n    await file_writer(new Uint8Array(chunkSizeBuffer));\r\n\r\n    let total_bytes = 0; // \u7528\u4E8E\u7EDF\u8BA1\u603B\u5B57\u8282\u6570\r\n    let nonce_counter = BigInt(1);\r\n    let position = 0;\r\n\r\n    // \u5199\u5165iv\u53C2\u6570\r\n    const nonce_counter_start = new ArrayBuffer(8);\r\n    new DataView(nonce_counter_start).setBigUint64(0, nonce_counter, true);\r\n    await file_writer(new Uint8Array(nonce_counter_start));\r\n\r\n    // \u5206\u5757\u52A0\u5BC6\u5904\u7406\r\n    await callback?.(0);\r\n    const cryptoKey = await crypto.subtle.importKey('raw', derived_key, { name: 'AES-GCM' }, false, ['encrypt']);\r\n    while (true) {\r\n        // \u8BFB\u53D6\u6587\u4EF6\u5757\r\n        const chunk = await file_reader(position, position + chunk_size);\r\n        // chunk should be a Uint8Array\r\n        if (!(chunk instanceof Uint8Array)) throw new Exceptions.BadDataException(\"The file chunk is not a Uint8Array.\");\r\n        if (chunk.length === 0) break;\r\n        const isFinalChunk = chunk.length < chunk_size;\r\n\r\n        // \u4E3A\u6BCF\u4E2A\u5206\u5757\u751F\u6210\u65B0IV (12\u5B57\u8282)\r\n        const iv = new ArrayBuffer(12);\r\n        // \u786E\u4FDD IV \u552F\u4E00\r\n        if (nonce_counter >= POWER_2_64) {\r\n            throw new Exceptions.IVException(\"nonce_counter exceeded the maximum value.\");\r\n        }\r\n        new DataView(iv).setBigUint64(4, nonce_counter, true); // \u5199\u51658\u5B57\u8282\u8BA1\u6570\u5668\r\n        nonce_counter++; // \u8BA1\u6570\u5668\u52A01\r\n\r\n        if (isFinalChunk) {\r\n            await file_writer(new Uint8Array(TAIL_BLOCK_MARKER));\r\n            // \u5199\u5165\u8BE5\u5206\u5757\u957F\u5EA6\r\n            const chunkLengthBuffer = new ArrayBuffer(8);\r\n            new DataView(chunkLengthBuffer).setBigUint64(0, BigInt(chunk.length), true);\r\n            await file_writer(new Uint8Array(chunkLengthBuffer));\r\n        }\r\n\r\n        // \u4F7F\u7528WebCrypto\u8FDB\u884C\u52A0\u5BC6\r\n        const ivArray = new Uint8Array(iv);\r\n        const ciphertext = await crypto.subtle.encrypt(\r\n            {\r\n                name: 'AES-GCM',\r\n                iv: ivArray,\r\n            },\r\n            cryptoKey,\r\n            chunk\r\n        );\r\n\r\n        // \u5199\u5165\u5206\u5757\u4FE1\u606F: \u5BC6\u6587 + tag(16\u5B57\u8282)\r\n        // \u5BC6\u6587\u7684\u957F\u5EA6\u548C\u539F\u6587\u76F8\u540C\r\n        const ciphertextArray = new Uint8Array(ciphertext);\r\n        await file_writer(ciphertextArray);\r\n\r\n        total_bytes += chunk.length;\r\n        position += chunk.length;\r\n\r\n        await callback?.(total_bytes);\r\n    }\r\n\r\n    // \u5199\u5165\u7ED3\u675F\u6807\u8BB0\u548C\u603B\u5B57\u8282\u6570\r\n    await file_writer(new Uint8Array(END_MARKER));\r\n\r\n    const totalBytesBuffer = new ArrayBuffer(8);\r\n    new DataView(totalBytesBuffer).setBigUint64(0, BigInt(total_bytes), true);\r\n    await file_writer(new Uint8Array(totalBytesBuffer));\r\n    await file_writer(new Uint8Array(FILE_END_MARKER));\r\n\r\n    return true;\r\n}\r\n\r\n/**\r\n * \u89E3\u5BC6\u6587\u4EF6\uFF081.1\uFF09\r\n * @deprecated \u4EC5\u4F9B\u517C\u5BB91.1\u7248\u672C\u4F7F\u7528\u3002\r\n * @param {(start: number, end: number) => Promise<Uint8Array<ArrayBuffer>>} file_reader - \u6587\u4EF6\u8BFB\u53D6\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0(start: number, end: number) => Promise<Uint8Array<ArrayBuffer>>\r\n * @param {Function} file_writer - \u6587\u4EF6\u5199\u5165\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0write(Uint8Array<ArrayBuffer>)\u65B9\u6CD5\r\n * @param {((decrypted_bytes: number, processed_bytes: number) => void)|((decrypted_bytes: number) => void)|null} callback - \u53EF\u9009\u56DE\u8C03\u51FD\u6570\uFF0C\u7528\u4E8E\u62A5\u544A\u52A0\u5BC6\u8FDB\u5EA6\r\n * @param {string} user_key - \u7528\u6237\u63D0\u4F9B\u7684\u89E3\u5BC6\u5BC6\u94A5\r\n * @param {Function} [callback=null] - \u8FDB\u5EA6\u56DE\u8C03\u51FD\u6570\r\n * @returns {Promise<boolean>} \u8FD4\u56DE\u89E3\u5BC6\u662F\u5426\u6210\u529F\r\n */\r\nexport async function decrypt_file_V_1_1_0(file_reader, file_writer, user_key, callback = null) {\r\n    // \u8BFB\u53D6\u6587\u4EF6\u5934\u5E76\u9A8C\u8BC1\r\n    const header = await file_reader(0, 16);\r\n    if (str_decode(header) !== 'MyEncryption/1.1') {\r\n        throw new TypeError(\"Invalid file format\");\r\n    }\r\n    let read_pos = 16;\r\n\r\n    // \u8BFB\u53D6\u4E3B\u5BC6\u94A5\u5BC6\u6587\u957F\u5EA6\r\n    const ekey_len_bytes = await file_reader(read_pos, read_pos + 4);\r\n    const ekey_len = new DataView(ekey_len_bytes.buffer).getUint32(0, true);\r\n    read_pos += 4;\r\n\r\n    // \u8BFB\u53D6\u4E3B\u5BC6\u94A5\u5BC6\u6587\u5E76\u8DF3\u8FC7\u586B\u5145\r\n    const ekey = str_decode(await file_reader(read_pos, read_pos + ekey_len));\r\n    read_pos += 1024; // \u76F4\u63A5\u8DF3\u8FC71024\u5B57\u8282\u533A\u57DF\r\n\r\n    // \u89E3\u5BC6\u4E3B\u5BC6\u94A5\r\n    const key = await decrypt_data(ekey, user_key);\r\n\r\n    // \u8BFB\u53D6\u5934\u90E8JSON\u957F\u5EA6\r\n    const json_len_bytes = await file_reader(read_pos, read_pos + 4);\r\n    const json_len = new DataView(json_len_bytes.buffer).getUint32(0, true);\r\n    read_pos += 4;\r\n\r\n    // \u89E3\u6790\u5934\u90E8JSON\r\n    const header_json = JSON.parse(\r\n        str_decode(await file_reader(read_pos, read_pos + json_len))\r\n    );\r\n    read_pos += json_len;\r\n\r\n    // \u63D0\u53D6\u6D3E\u751F\u53C2\u6570\r\n    const [phrase, salt_hex] = header_json.parameter.split(':');\r\n    const salt = unhexlify(salt_hex);\r\n    const iv4key = unhexlify(header_json.iv);\r\n    const N = header_json.N;\r\n\r\n    // \u5BF9\u5E94\u52A0\u5BC6\u65F6\uFF0C\u9700\u8981\u63D0\u4F9B\u4E00\u4E2Aiv\uFF0C\u6211\u4EEC\u628Aiv\u53D6\u56DE\u6765\uFF0C\u91CD\u65B0\u751F\u6210\u5BC6\u94A5\uFF08\u6240\u6709\u6570\u636E\u5757\u7684\u5BC6\u94A5\u662F\u76F8\u540C\u7684\uFF09\r\n    callback?.(0, 0);\r\n    await nextTick();\r\n    const { derived_key } = await derive_key(key, iv4key, phrase, N, salt);\r\n\r\n    let total_bytes = 0;\r\n    // \u5206\u5757\u89E3\u5BC6\u5FAA\u73AF\r\n    const cryptoKey = await crypto.subtle.importKey('raw', derived_key, { name: 'AES-GCM' }, false, ['decrypt']);\r\n    while (true) {\r\n        // \u8BFB\u53D6\u5206\u5757\u957F\u5EA6\u6807\u8BB0\r\n        const chunk_len_bytes = await file_reader(read_pos, read_pos + 8);\r\n        read_pos += 8;\r\n\r\n        // \u68C0\u67E5\u7ED3\u675F\u6807\u8BB0\r\n        if (chunk_len_bytes.every((v, i) =>\r\n            v === [0xFF, 0xFD, 0xF0, 0x10, 0x13, 0xD0, 0x12, 0x18][i]\r\n        )) break;\r\n\r\n        // \u89E3\u6790\u5206\u5757\u957F\u5EA6\r\n        const chunk_len = Number(\r\n            new DataView(chunk_len_bytes.buffer).getBigUint64(0, true)\r\n        );\r\n\r\n        // \u8BFB\u53D6IV(12\u5B57\u8282)\u3001\u5BC6\u6587\u548Ctag(16\u5B57\u8282)\r\n        const iv = await file_reader(read_pos, read_pos + 12);\r\n        read_pos += 12;\r\n        const ciphertext = await file_reader(read_pos, read_pos + chunk_len + 16);\r\n        read_pos += chunk_len + 16;\r\n\r\n        const full_ciphertext = ciphertext;\r\n\r\n        // \u4F7F\u7528WebCrypto\u89E3\u5BC6\r\n        const decrypted = await crypto.subtle.decrypt(\r\n            {\r\n                name: 'AES-GCM',\r\n                iv: iv,\r\n            },\r\n            cryptoKey,\r\n            full_ciphertext\r\n        );\r\n\r\n        // \u5199\u5165\u89E3\u5BC6\u540E\u7684\u6570\u636E\r\n        await file_writer(new Uint8Array(decrypted));\r\n        total_bytes += decrypted.byteLength;\r\n        if (callback) callback(total_bytes, read_pos);\r\n    }\r\n\r\n    // \u9A8C\u8BC1\u603B\u5B57\u8282\u6570\u548C\u7ED3\u675F\u6807\u8BB0\r\n    const total_bytes_bytes = await file_reader(read_pos, read_pos + 8);\r\n    const total_bytes_decrypted = Number(\r\n        new DataView(total_bytes_bytes.buffer).getBigUint64(0, true)\r\n    );\r\n    read_pos += 8;\r\n\r\n    const end_marker = await file_reader(read_pos, read_pos + 2);\r\n    if (total_bytes !== total_bytes_decrypted) throw new Exceptions.FileCorruptedException(\"File corrupted: total bytes mismatch\")\r\n    if (!end_marker.every((v, i) => v === [0x55, 0xAA][i])) throw new Exceptions.InvalidEndMarkerException(\"Invalid end marker\");\r\n    \r\n    if (callback) callback(total_bytes, read_pos + 2);\r\n\r\n    return true;\r\n}\r\n/**\r\n * \u89E3\u5BC6\u6587\u4EF6\r\n * @param {(start: number, end: number) => Promise<Uint8Array<ArrayBuffer>>} file_reader - \u6587\u4EF6\u8BFB\u53D6\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0(start: number, end: number) => Promise<Uint8Array<ArrayBuffer>>\r\n * @param {(data: Uint8Array<ArrayBuffer>) => Promise<void>} file_writer - \u6587\u4EF6\u5199\u5165\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0write(Uint8Array<ArrayBuffer>)\u65B9\u6CD5\r\n * @param {string|Uint8Array<ArrayBuffer>} user_key - \u7528\u6237\u63D0\u4F9B\u7684\u89E3\u5BC6\u5BC6\u94A5\uFF08\u5B57\u7B26\u4E32\uFF09\u6216\u8005\u6D3E\u751F\u540E\u7684\u5BC6\u94A5\uFF08Uint8Array<ArrayBuffer>\uFF09\r\n * @param {((decrypted_bytes: number, processed_bytes: number) => void)|((decrypted_bytes: number) => void)|null} callback - \u53EF\u9009\u56DE\u8C03\u51FD\u6570\uFF0C\u7528\u4E8E\u62A5\u544A\u52A0\u5BC6\u8FDB\u5EA6\r\n * @returns {Promise<boolean>} \u8FD4\u56DE\u89E3\u5BC6\u662F\u5426\u6210\u529F\r\n */\r\nexport async function decrypt_file(file_reader, file_writer, user_key, callback = null) {\r\n    // fast-fail\r\n    if (typeof file_reader !== 'function' || typeof file_writer !== 'function') {\r\n        throw new Exceptions.InvalidParameterException(\"file_reader and file_writer must be functions\");\r\n    }\r\n    if ((typeof user_key !== 'string') && (!(user_key instanceof ArrayBuffer)) && (!(user_key instanceof Uint8Array))) {\r\n        throw new Exceptions.InvalidParameterException(\"user_key must be a string or ArrayBuffer or Uint8Array\");\r\n    }\r\n    const original_callback = callback;\r\n    callback = (typeof callback === 'function') ? async function UserCallback(d, p) {\r\n        try {\r\n            // @ts-ignore\r\n            const r = original_callback?.(d, p);\r\n            // @ts-ignore\r\n            if ((r) && (r instanceof Promise)) await r;\r\n        } catch (e) {\r\n            throw new Exceptions.UnhandledExceptionInUserCallback('An unhandled exception was encountered during a user callback.', { cause: e });\r\n        }\r\n    } : null;\r\n\r\n    // \u8003\u8651\u5230JavaScript\u4E00\u822C\u4E0D\u4F1A\u5904\u74062^53\u6570\u91CF\u7EA7\u7684\u6587\u4EF6\uFF0C\u6211\u4EEC\u5BF9read_pos\u4F7F\u7528number\u800C\u4E0D\u662Fbigint\r\n    let read_pos = 16 + 4;\r\n    const version = await GetFileVersion(file_reader);\r\n\r\n    if (version === ENCRYPTION_FILE_VER_1_1_0) {\r\n        if (typeof user_key !== 'string') throw new Exceptions.NotSupportedException(\"operation not supported\");\r\n        return await decrypt_file_V_1_1_0(file_reader, file_writer, user_key, callback);\r\n    }\r\n\r\n    const ekey_len = new DataView((await file_reader(read_pos, read_pos + 4)).buffer).getUint32(0, true);\r\n    const ekey = str_decode(await file_reader(read_pos + 4, read_pos + 4 + ekey_len));\r\n\r\n    read_pos += PADDING_SIZE;\r\n    \r\n    if (ekey_len > PADDING_SIZE) {\r\n        throw new Exceptions.InternalError(\"(Internal Error) This should not happen. Contact the application developer.\");\r\n    }\r\n        \r\n    // \u89E3\u5BC6\u4E3B\u5BC6\u94A5\r\n    const key = (typeof user_key === 'string') ? await decrypt_data(ekey, user_key) : null;\r\n\r\n    // \u8BFB\u53D6\u5934\u90E8JSON\u957F\u5EA6\r\n    const json_len_bytes = await file_reader(read_pos, read_pos + 4);\r\n    const json_len = new DataView(json_len_bytes.buffer).getUint32(0, true);\r\n    read_pos += 4;\r\n\r\n    // \u89E3\u6790\u5934\u90E8JSON\r\n    const header_json = JSON.parse(\r\n        str_decode(await file_reader(read_pos, read_pos + json_len))\r\n    );\r\n    read_pos += json_len;\r\n\r\n    // \u63D0\u53D6\u6D3E\u751F\u53C2\u6570\r\n    const header_version = header_json.v;\r\n    if (!([5.5].includes(header_version))) throw new Exceptions.EncryptionVersionMismatchException();\r\n    const [phrase, salt_hex] = header_json.parameter.split(':');\r\n    const salt = unhexlify(salt_hex);\r\n    const iv4key = unhexlify(header_json.iv);\r\n    const N = header_json.N;\r\n    const algorithm = header_json.a;\r\n\r\n    // \u5224\u65AD\u662F\u5426\u652F\u6301\u7684\u52A0\u5BC6\u7B97\u6CD5\r\n    CheckAlgorithm(algorithm);\r\n\r\n    // \u83B7\u53D6chunk size\u548Civ\u53C2\u6570\r\n    const chunk_size = Number(new DataView((await file_reader(read_pos, read_pos + 8)).buffer).getBigUint64(0, true));\r\n    let nonce_counter = BigInt(new DataView((await file_reader(read_pos + 8, read_pos + 16)).buffer).getBigUint64(0, true));\r\n    read_pos += 16;\r\n\r\n    // \u5BF9\u5E94\u52A0\u5BC6\u65F6\uFF0C\u9700\u8981\u63D0\u4F9B\u4E00\u4E2Aiv\uFF0C\u6211\u4EEC\u628Aiv\u53D6\u56DE\u6765\uFF0C\u91CD\u65B0\u751F\u6210\u5BC6\u94A5\uFF08\u6240\u6709\u6570\u636E\u5757\u7684\u5BC6\u94A5\u662F\u76F8\u540C\u7684\uFF09\r\n    await callback?.(0, 0);\r\n    await nextTick();\r\n    const derived_key = (typeof user_key === 'string') ? (\r\n        key ? ((await derive_key(key, iv4key, phrase, N, salt)).derived_key) : Exceptions.raise(new Exceptions.InternalError())\r\n    ) : user_key;\r\n\r\n    let total_bytes = 0, is_final_chunk = false;\r\n    // \u5206\u5757\u89E3\u5BC6\u5FAA\u73AF\r\n    const cryptoKey = await crypto.subtle.importKey('raw', derived_key, { name: 'AES-GCM' }, false, ['decrypt']);\r\n    while (true) {\r\n        // \u8BFB\u53D6\u5206\u5757\u957F\u5EA6\u6807\u8BB0\r\n        const chunk_tag = await file_reader(read_pos, read_pos + 8);\r\n\r\n        // \u68C0\u67E5\u7ED3\u675F\u6807\u8BB0\r\n        let real_size = 0;\r\n        if ((chunk_tag).every((v, i) => v === END_IDENTIFIER[i])) {\r\n            const full_bytes = await file_reader(read_pos, read_pos + 32); // \u8BFB\u53D6\u5B8C\u6574\u6807\u8BB0\r\n            if (full_bytes.every((v, i) => v === END_MARKER[i])) {\r\n                read_pos += 32; // \u8DF3\u8FC7\u6807\u8BB0\r\n                break;\r\n            }\r\n            if (full_bytes.every((v, i) => v === TAIL_BLOCK_MARKER[i])) {\r\n                is_final_chunk = true;\r\n                read_pos += 32; // \u8DF3\u8FC7\u6807\u8BB0\r\n                // \u8BFB\u53D6\u5206\u5757\u957F\u5EA6\r\n                const chunk_len_bytes = await file_reader(read_pos, read_pos + 8);\r\n                read_pos += 8;\r\n                real_size = Number(new DataView(chunk_len_bytes.buffer).getBigUint64(0, true));\r\n                if (real_size === 0) break; // \u8BFB\u53D6\u52300\u5B57\u8282\uFF0C\u7ED3\u675F\u5FAA\u73AF\r\n            }\r\n        }\r\n\r\n        // \u89E3\u6790\u5206\u5757\u957F\u5EA6\uFF08\u4E0D\u5305\u62EC16\u5B57\u8282\u6807\u7B7E\uFF09\r\n        const ciphertext_length = (is_final_chunk ? real_size : chunk_size)\r\n\r\n        // \u83B7\u53D6iv\r\n        const iv_array = new ArrayBuffer(12);\r\n        new DataView(iv_array).setBigUint64(4, BigInt(nonce_counter), true);\r\n        nonce_counter++;\r\n        \r\n        // \u8BFB\u53D6\u5BC6\u6587\u548Ctag(16\u5B57\u8282)\r\n        const ciphertext = await file_reader(read_pos, read_pos + ciphertext_length + 16);\r\n        read_pos += ciphertext_length + 16;\r\n\r\n        const full_ciphertext = ciphertext;\r\n\r\n        // \u4F7F\u7528WebCrypto\u89E3\u5BC6\r\n        try {\r\n            const decrypted = await crypto.subtle.decrypt(\r\n                {\r\n                    name: 'AES-GCM',\r\n                    iv: new Uint8Array(iv_array),\r\n                },\r\n                cryptoKey,\r\n                full_ciphertext\r\n            );\r\n\r\n            // \u5199\u5165\u89E3\u5BC6\u540E\u7684\u6570\u636E\r\n            await file_writer(new Uint8Array(decrypted));\r\n            total_bytes += decrypted.byteLength;\r\n        } catch (e) {\r\n            if (!e || !(e instanceof DOMException)) throw new Exceptions.InternalError(`Internal error.`, { cause: e });\r\n            const name = e.name;\r\n            if (name === 'InvalidAccessError') throw new Exceptions.InvalidParameterException('InvalidAccessError.', { cause: e });\r\n            if (name === 'OperationError') throw new Exceptions.UnexpectedFailureInChunkDecryptionException(undefined, { cause: e });\r\n            throw new Exceptions.InternalError(`Unexpected error.`, { cause: e });\r\n        }\r\n        if (callback) await callback(total_bytes, read_pos);\r\n    }\r\n\r\n    // \u9A8C\u8BC1\u603B\u5B57\u8282\u6570\u548C\u7ED3\u675F\u6807\u8BB0\r\n    const total_bytes_bytes = await file_reader(read_pos, read_pos + 8);\r\n    const total_bytes_decrypted = Number(\r\n        new DataView(total_bytes_bytes.buffer).getBigUint64(0, true)\r\n    );\r\n    read_pos += 8;\r\n\r\n    const end_marker = await file_reader(read_pos, read_pos + FILE_END_MARKER.length);\r\n    if (total_bytes !== total_bytes_decrypted) throw new Exceptions.FileCorruptedException(\"Total bytes mismatch\")\r\n    if (!end_marker.every((v, i) => v === FILE_END_MARKER[i])) throw new Exceptions.InvalidEndMarkerException();\r\n    \r\n    if (callback) await callback(total_bytes, read_pos + FILE_END_MARKER.length);\r\n\r\n    return true;\r\n}\r\n\r\n\r\n/**\r\n * @param {Blob} blob\r\n * @param {string} password\r\n * @param {((processed_bytes: number) => void)|null} callback - \u53EF\u9009\u56DE\u8C03\u51FD\u6570\uFF0C\u7528\u4E8E\u62A5\u544A\u52A0\u5BC6\u8FDB\u5EA6\r\n * @param {string|null} phrase - \u53EF\u9009\u77ED\u8BED\uFF0C\u7528\u4E8E\u5BC6\u94A5\u6D3E\u751F\r\n * @param {number|null} N - scrypt\u53C2\u6570N\r\n * @param {number} chunk_size - \u5206\u5757\u5927\u5C0F\uFF0C\u9ED8\u8BA4\u4E3A32MiB\r\n * @returns {Promise<Blob>}\r\n */\r\nexport async function encrypt_blob(blob, password, callback, phrase, N, chunk_size) {\r\n    if (!(blob instanceof Blob)) throw new Exceptions.InvalidParameterException(\"blob must be a Blob\");\r\n    const buffer = [];\r\n    const file_reader = async (/** @type {number} */ start, /** @type {number} */ end) => new Uint8Array(await (blob.slice(start, end).arrayBuffer()));\r\n    const file_writer = async (/** @type {Uint8Array<ArrayBuffer>} */ data) => { buffer.push(data) };\r\n    if (!await encrypt_file(file_reader, file_writer, password, callback, phrase, N, chunk_size)) throw new Exceptions.UnexpectedError();\r\n    return new Blob(buffer);\r\n}\r\n/**\r\n * @param {Blob} blob\r\n * @param {string | Uint8Array<ArrayBuffer>} password\r\n * @param {((decrypted_bytes: number, processed_bytes: number) => void)|((decrypted_bytes: number) => void)|null} callback - \u53EF\u9009\u56DE\u8C03\u51FD\u6570\uFF0C\u7528\u4E8E\u62A5\u544A\u52A0\u5BC6\u8FDB\u5EA6\r\n * @returns {Promise<Blob>}\r\n */\r\nexport async function decrypt_blob(blob, password, callback) {\r\n    if (!(blob instanceof Blob)) throw new Exceptions.InvalidParameterException(\"blob must be a Blob\");\r\n    const buffer = [];\r\n    const file_reader = async (/** @type {number} */ start, /** @type {number} */ end) => new Uint8Array(await (blob.slice(start, end).arrayBuffer()));\r\n    const file_writer = async (/** @type {Uint8Array} */ data) => { buffer.push(data) };\r\n    if (!await decrypt_file(file_reader, file_writer, password, callback)) throw new Exceptions.UnexpectedError();\r\n    return new Blob(buffer);\r\n}", "// @ts-nocheck\r\nimport { str_encode, str_decode } from \"./str.js\";\r\nimport { encrypt_data, decrypt_data, parse_ciphertext } from \"./encrypt_data.js\";\r\nimport {\r\n    PADDING_SIZE, normalize_version,\r\n    ENCRYPTION_FILE_VER_1_1_0, ENCRYPTION_FILE_VER_1_2_10020,\r\n    GetFileVersion,\r\n    GetFileInfo,\r\n} from \"./internal-util.js\";\r\nimport * as Exceptions from './exceptions.js';\r\n\r\n\r\n/**\r\n * Export the file's master key.\r\n * @param {Blob} file_head File header. Recommended to provide 5KB. At least provide 1044 bytes(V1.1) or .\r\n * @param {String} current_key current file password\r\n * @param {String} export_key The password to protect the master key\r\n * @returns String exported key\r\n */\r\nexport async function export_master_key(file_head, current_key, export_key) {\r\n    if (!(file_head instanceof Blob)) throw new Exceptions.InvalidParameterException();\r\n    if (typeof current_key !== 'string' || typeof export_key !== 'string') throw new Exceptions.InvalidParameterException();\r\n    if (file_head.size < (1024 + 16 + 4)) throw new Exceptions.BadDataException('Data not enough');\r\n\r\n    // Verify file header\r\n    const version = await GetFileVersion(async (start, end) => {\r\n        return new Uint8Array(await file_head.slice(start, end).arrayBuffer())\r\n    });\r\n\r\n    if (version === ENCRYPTION_FILE_VER_1_1_0) {\r\n        // Read encrypted master key length and ciphertext\r\n        const ekey_len = new DataView(await file_head.slice(16, 20).arrayBuffer()).getUint32(0, true);\r\n        const buffer = await file_head.slice(20, 20 + ekey_len).arrayBuffer();\r\n        const ekey_ciphertext = str_decode(buffer);\r\n        // Decrypt master key with current_key and re-encrypt with export_key\r\n        return await encrypt_data(await decrypt_data(ekey_ciphertext, current_key), export_key);\r\n    }\r\n\r\n    if (version === ENCRYPTION_FILE_VER_1_2_10020) {\r\n        if (file_head.size < 16 + PADDING_SIZE) throw new Exceptions.BadDataException('Data not enough');\r\n        const ekey_len = new DataView(await file_head.slice(20, 24).arrayBuffer()).getUint32(0, true);\r\n        const buffer = await file_head.slice(24, 24 + ekey_len).arrayBuffer();\r\n        const ekey_ciphertext = str_decode(buffer);\r\n        // Decrypt master key with current_key and re-encrypt with export_key\r\n        return await encrypt_data(await decrypt_data(ekey_ciphertext, current_key), export_key);\r\n    }\r\n\r\n    throw new Exceptions.EncryptionVersionMismatchException();\r\n}\r\n\r\n\r\n\r\nasync function change_file_password_1_1_0(file_head, current_key, new_key) {\r\n    if (!(file_head instanceof Blob)) throw new Exceptions.InvalidParameterException();\r\n    if (typeof current_key !== 'string' || typeof new_key !== 'string') throw new Exceptions.InvalidParameterException();\r\n    if (file_head.size < (1024 + 16 + 4)) throw new Exceptions.BadDataException('Data not enough');\r\n\r\n    // Verify file header\r\n    const headerBlob = file_head.slice(0, 16);\r\n    const header = await headerBlob.text();\r\n    if (header !== \"MyEncryption/1.1\") {\r\n        throw new TypeError(\"Invalid file format\");\r\n    }\r\n\r\n    // Read encrypted master key length and ciphertext\r\n    const ekey_len = new DataView(await file_head.slice(16, 20).arrayBuffer()).getUint32(0, true);\r\n    const ekey_ciphertext = str_decode(await file_head.slice(20, 20 + ekey_len).arrayBuffer());\r\n\r\n    // Decrypt master key with current_key and re-encrypt with export_key\r\n    const new_ekey = await encrypt_data(await decrypt_data(ekey_ciphertext, current_key), new_key);\r\n    // Check length\r\n    if (new_ekey.length > 1024) {\r\n        throw new Error(\"(Internal Error) This should not happen. Contact the application developer.\");\r\n    }\r\n    const new_ekey_len = new_ekey.length;\r\n    const new_ekey_len_bytes = new ArrayBuffer(4);\r\n    const new_ekey_len_view = new DataView(new_ekey_len_bytes);\r\n    new_ekey_len_view.setUint32(0, new_ekey_len, true);\r\n\r\n    const new_ekey_parts = [headerBlob, new_ekey_len_bytes, str_encode(new_ekey)];\r\n    const padding = new Uint8Array(1024 - new_ekey.length).fill(0);\r\n    new_ekey_parts.push(padding);\r\n\r\n    return new Blob(new_ekey_parts);\r\n}\r\n/**\r\n * Change file password\r\n * note: \u4E0D\u5EFA\u8BAE\u5728web\u7AEF\u66F4\u6539\u5BC6\u7801\u3002\u7531\u4E8E\u6D4F\u89C8\u5668\u5199\u5165\u6587\u4EF6\u7684\u5DE5\u4F5C\u539F\u7406\uFF08https://developer.mozilla.org/zh-CN/docs/Web/API/FileSystemFileHandle/createWritable \uFF09\r\n * \u4EFB\u4F55\u901A\u8FC7\u5199\u5165\u6D41\u9020\u6210\u7684\u66F4\u6539\u5728\u5199\u5165\u6D41\u88AB\u5173\u95ED\u524D\u90FD\u4E0D\u4F1A\u53CD\u6620\u5230\u6587\u4EF6\u53E5\u67C4\u6240\u4EE3\u8868\u7684\u6587\u4EF6\u4E0A\u3002\u8FD9\u901A\u5E38\u662F\u5C06\u6570\u636E\u5199\u5165\u5230\u4E00\u4E2A\u4E34\u65F6\u6587\u4EF6\u6765\u5B9E\u73B0\u7684\uFF0C\u7136\u540E\u53EA\u6709\u5728\u5199\u5165\u6587\u4EF6\u6D41\u88AB\u5173\u95ED\u540E\u624D\u4F1A\u7528\u4E34\u65F6\u6587\u4EF6\u66FF\u6362\u6389\u6587\u4EF6\u53E5\u67C4\u6240\u4EE3\u8868\u7684\u6587\u4EF6\u3002\r\n * \u4E5F\u5C31\u662F\u8BF4\uFF0C\u65E7\u5BC6\u7801\u5C06\u59CB\u7EC8\u5B58\u5728\u4E8E\u78C1\u76D8\u4E0A\u3002\u8FD9\u5C06\u5BFC\u81F4\u654F\u611F\u6570\u636E\u6CC4\u9732\u3002\r\n * \u53E6\u5916\uFF0C\u7531\u4E8E\u8FD9\u4E2A\u7279\u6027\uFF0C\u5927\u6587\u4EF6\u76F8\u5173\u64CD\u4F5C\u4F1A\u53D8\u5F97\u975E\u5E38\u975E\u5E38\u6162\u3002\r\n * \u6240\u4EE5\uFF0C\u9664\u975E\u7279\u6B8A\u60C5\u51B5\uFF0C\u52A1\u5FC5\u59CB\u7EC8\u4F7F\u7528 native \u5E94\u7528\u7A0B\u5E8F\u6765\u4FEE\u6539\u6587\u4EF6\u5BC6\u7801\r\n * @param {Blob} file_head File header. Recommended to provide 2KB. At least provide 1044 bytes.\r\n * @param {String} current_key current file password\r\n * @param {String} new_key The new password\r\n * @param {?string} phrase phrase. If not provided, the previous value will be used.\r\n * @param {?number} N N. If not provided, the previous value will be used.\r\n * @returns Blob The new file header. Note that the size of the new header differs from the original file. Do not use it to construct a new file. Instead, overwrite the original file header directly with the new header without offsetting the file.  \r\n * @throws {Error} If the file header is invalid or the file size is not enough.\r\n */\r\nexport async function change_file_password(file_head, current_key, new_key, phrase = null, N = null) {\r\n    if (!(file_head instanceof Blob)) throw new Exceptions.InvalidParameterException();\r\n    if (typeof current_key !== 'string' || typeof new_key !== 'string') throw new Exceptions.InvalidParameterException();\r\n    if (file_head.size < (1024 + 16 + 4)) throw new Exceptions.BadDataException('Data not enough');\r\n\r\n    // Verify file header\r\n    const version = await GetFileVersion(async (start, end) => {\r\n        return new Uint8Array(await file_head.slice(start, end).arrayBuffer())\r\n    });\r\n\r\n    if (version === ENCRYPTION_FILE_VER_1_1_0) return await change_file_password_1_1_0(file_head, current_key, new_key);\r\n\r\n    // Read encrypted master key length and ciphertext\r\n    const ekey_len = new DataView(await file_head.slice(20, 24).arrayBuffer()).getUint32(0, true);\r\n    const ekey_ciphertext = str_decode(await file_head.slice(24, 24 + ekey_len).arrayBuffer());\r\n\r\n    // Decrypt master key with current_key and re-encrypt with export_key\r\n    if (!N || !phrase) {\r\n        const { N : _1, phrase : _2 } = await parse_ciphertext(ekey_ciphertext);\r\n        if (!N) N = _1;\r\n        if (!phrase) phrase = _2;\r\n    }\r\n    const new_ekey = await encrypt_data(await decrypt_data(ekey_ciphertext, current_key), new_key, phrase, N);\r\n    // Check length\r\n    if (new_ekey.length > 1024) {\r\n        throw new Error(\"(Internal Error) This should not happen. Contact the application developer.\");\r\n    }\r\n    const new_ekey_len = new_ekey.length;\r\n    const new_ekey_len_bytes = new ArrayBuffer(4);\r\n    const new_ekey_len_view = new DataView(new_ekey_len_bytes);\r\n    new_ekey_len_view.setUint32(0, new_ekey_len, true);\r\n\r\n    const new_ekey_parts = [file_head.slice(0, 20), new_ekey_len_bytes, str_encode(new_ekey)];\r\n    const padding = new Uint8Array(PADDING_SIZE - new_ekey.length - 4).fill(0);\r\n    new_ekey_parts.push(padding);\r\n\r\n    return new Blob(new_ekey_parts);\r\n}", "import * as Exceptions from './exceptions.js';\r\n\r\nconst CRYPT_CONTEXT = Object.create(null);\r\nCRYPT_CONTEXT[Symbol.toStringTag] = 'CryptContext';\r\nCRYPT_CONTEXT['toString'] = function () {\r\n    return `${this[Symbol.toStringTag]} Object`;\r\n};\r\n\r\nexport { CRYPT_CONTEXT as CryptContext };\r\n\r\n/**\r\n * @param {any} PromiseLike\r\n */\r\nasync function _await(PromiseLike) {\r\n    if (PromiseLike instanceof Promise) return await PromiseLike;\r\n    return PromiseLike;\r\n}\r\n\r\nexport async function crypt_context_create() {\r\n    const ctx = Object.create(CRYPT_CONTEXT);\r\n    Object.defineProperty(ctx, '_created', { value: true });\r\n    return ctx;\r\n}\r\n\r\nexport async function crypt_context_destroy(ctx) {\r\n    if (!ctx || ctx._released) throw new Exceptions.InvalidParameterException(\"Invalid context\");\r\n    for (const i of Reflect.ownKeys(ctx)) {\r\n        if (typeof i === 'symbol') {\r\n            Reflect.deleteProperty(ctx, i);\r\n            continue;\r\n        }\r\n        const o = Reflect.get(ctx, i);\r\n        if (o) {\r\n            if (o.release) await _await(o.release());\r\n            else if (o.free) await _await(o.free());\r\n            else if (o.reset) await _await(o.reset());\r\n            else if (o.clear) await _await(o.clear());\r\n        }\r\n        if (!i.startsWith('_')) Reflect.deleteProperty(ctx, i);\r\n    }\r\n    Object.defineProperty(ctx, '_released', { value: true });\r\n    return true;\r\n}\r\n\r\n", "// streamed encryption\r\nimport { CryptContext } from \"./context.js\";\r\nimport * as Exceptions from './exceptions.js';\r\nimport { str_decode } from \"./str.js\";\r\nimport { derive_key } from \"./derive_key.js\";\r\nimport { unhexlify } from \"./binascii.js\";\r\nimport { decrypt_data } from \"./encrypt_data.js\";\r\nimport { normalize_version, ENCRYPTION_FILE_VER_1_2_10020 } from \"./encrypt_file.js\";\r\nimport { PADDING_SIZE, END_IDENTIFIER, END_MARKER, TAIL_BLOCK_MARKER, FILE_END_MARKER } from './internal-util.js';\r\n\r\nconst crypto = globalThis.crypto; // To avoid the possible security risk\r\n\r\n\r\nexport class InputStream {\r\n    /** @type {((start: number, end: number, signal?: AbortSignal) => Promise<Uint8Array<ArrayBuffer>>) | null} */\r\n    #reader;\r\n    #cache = {\r\n        position: 0,\r\n        end: 0,\r\n        /** @type {?Uint8Array<ArrayBuffer>} */ data: null,\r\n    };\r\n    #size;\r\n    get [Symbol.toStringTag]() {\r\n        return 'Stream';\r\n    }\r\n\r\n    /**\r\n     * @param {(start: number, end: number, signal?: AbortSignal) => Promise<Uint8Array<ArrayBuffer>>} reader The reader function\r\n     * @param {number} size The size of the stream\r\n     */\r\n    constructor(reader, size) {\r\n        if (typeof reader !== 'function') throw new Exceptions.InvalidParameterException('Stream: Invalid reader');\r\n        this.#reader = reader;\r\n        if (typeof size !== 'number') throw new Exceptions.InvalidParameterException('Stream: Invalid size');\r\n        this.#size = size;\r\n    }\r\n\r\n    get size() {\r\n        return this.#size;\r\n    }\r\n\r\n    /** @type {AbortController|null} */\r\n    #abort_controller = null;\r\n\r\n    /**\r\n     * Read a stream\r\n     * @param {Number} start start pos\r\n     * @param {Number} end end pos\r\n     * @param {Number|null} suggestion_end The suggested end. Used for caching.\r\n     * @param {AbortController|null} abort The abort controller. Used for aborting the read.\r\n     * @returns {Promise<Uint8Array<ArrayBuffer>>}\r\n     */\r\n    async read(start, end, suggestion_end = null, abort = null) {\r\n        if (!this.#reader) throw new Error('Stream: The stream has been closed.');\r\n        if (this.#cache.position != null && this.#cache.end && this.#cache.data && (start >= this.#cache.position && end <= this.#cache.end)) {\r\n            // cache match\r\n            return this.#cache.data.slice(start - this.#cache.position, end - this.#cache.position);\r\n        }\r\n\r\n        // normalize parameters\r\n        if (start < 0) throw new Exceptions.InvalidParameterException('Stream: Invalid start position');\r\n        if (end > this.#size) end = this.#size;\r\n        if (suggestion_end != null && suggestion_end > this.#size) suggestion_end = this.#size;\r\n\r\n        this.#abort_controller = abort;\r\n        if (suggestion_end != null && suggestion_end !== 0) {\r\n            // cache policy\r\n            const data = await this.#reader(start, suggestion_end, abort?.signal);\r\n            this.#abort_controller = null;\r\n            // save cache\r\n            this.#cache.position = start;\r\n            this.#cache.end = start + data.length;\r\n            this.#cache.data = (data);\r\n            // return data\r\n            return data.slice(0, end - start);\r\n        }\r\n        // cache mismatch\r\n        const data = await this.#reader(start, end, abort?.signal);\r\n        this.#abort_controller = null;\r\n        return data;\r\n    }\r\n\r\n    abort() {\r\n        this.#abort_controller?.abort();\r\n    }\r\n\r\n    purge() {\r\n        this.#cache.position = this.#cache.end = 0;\r\n        this.#cache.data = null;\r\n    }\r\n\r\n    close() {\r\n        this.#reader = null;\r\n        this.purge();\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * Prepare for a stream decryption.\r\n * @param {CryptContext} ctx Context\r\n * @param {InputStream} stream The stream to decrypt.\r\n * @param {String} password The password.\r\n * @param {Object} [param3={}] Options.\r\n * @param {boolean} [param3.cache=true] Set if the cache is enabled.\r\n * @param {number} [param3.cache_max_size=256 * 1024 * 1024] Set the maximium size of the cache.\r\n */\r\nexport async function decrypt_stream_init(ctx, stream, password, {\r\n    cache = true,\r\n    cache_max_size = 256 * 1024 * 1024,\r\n} = {}) {\r\n    if (ctx._inited) throw new Exceptions.CryptContextReusedException();\r\n    Object.defineProperty(ctx, '_inited', { value: true });\r\n\r\n    ctx._type = '@decrypt_stream';\r\n    ctx.stream = {\r\n        stream: stream,\r\n        release: () => ctx.stream.stream.close(),\r\n    };\r\n\r\n    // \u6D3E\u751F\u5BC6\u94A5\r\n    const header = await stream.read(0, 13, 5000);\r\n    if (str_decode(header) !== 'MyEncryption/') {\r\n        throw new Exceptions.InvalidFileFormatException();\r\n    }\r\n    const top_header_version = (str_decode(await stream.read(13, 16)));\r\n    if(!(['1.1', '1.2'].includes(top_header_version))) {\r\n        throw new Exceptions.EncryptionVersionMismatchException();\r\n    }\r\n    const version_marker = new DataView((await stream.read(16, 20)).buffer).getUint32(0, true);\r\n    const version = normalize_version(top_header_version, version_marker);\r\n    let read_pos = 16 + 4;\r\n\r\n    if (version !== ENCRYPTION_FILE_VER_1_2_10020) {\r\n        throw new Exceptions.NotSupportedException(\"Cannot perform a streamed decryption on V1.1 files\");\r\n    }\r\n\r\n    const ekey_len = new DataView((await stream.read(read_pos, read_pos + 4)).buffer).getUint32(0, true);\r\n    const ekey = str_decode(await stream.read(read_pos + 4, read_pos + 4 + ekey_len));\r\n\r\n    read_pos += PADDING_SIZE;\r\n    \r\n    if (ekey_len > PADDING_SIZE) {\r\n        throw new Exceptions.InternalError(\"(Internal Error) This should not happen. Contact the application developer.\");\r\n    }\r\n        \r\n    // \u89E3\u5BC6\u4E3B\u5BC6\u94A5\r\n    const key = await decrypt_data(ekey, password);\r\n\r\n    // \u8BFB\u53D6\u5934\u90E8JSON\u957F\u5EA6\r\n    const json_len_bytes = await stream.read(read_pos, read_pos + 4);\r\n    const json_len = new DataView(json_len_bytes.buffer).getUint32(0, true);\r\n    read_pos += 4;\r\n\r\n    // \u89E3\u6790\u5934\u90E8JSON\r\n    const header_json = JSON.parse(\r\n        str_decode(await stream.read(read_pos, read_pos + json_len))\r\n    );\r\n    read_pos += json_len;\r\n\r\n    // \u63D0\u53D6\u6D3E\u751F\u53C2\u6570\r\n    const header_version = header_json.v;\r\n    if (!([5.5].includes(header_version))) throw new Exceptions.EncryptionVersionMismatchException();\r\n    const [phrase, salt_hex] = header_json.parameter.split(':');\r\n    const salt = unhexlify(salt_hex);\r\n    const iv4key = unhexlify(header_json.iv);\r\n    const N = header_json.N;\r\n\r\n    // \u83B7\u53D6chunk size\u548Civ\u53C2\u6570\r\n    const chunk_size = Number(new DataView((await stream.read(read_pos, read_pos + 8)).buffer).getBigUint64(0, true));\r\n    let nonce_counter = Number(new DataView((await stream.read(read_pos + 8, read_pos + 16)).buffer).getBigUint64(0, true));\r\n    read_pos += 16;\r\n\r\n    // \u5BF9\u5E94\u52A0\u5BC6\u65F6\uFF0C\u9700\u8981\u63D0\u4F9B\u4E00\u4E2Aiv\uFF0C\u6211\u4EEC\u628Aiv\u53D6\u56DE\u6765\uFF0C\u91CD\u65B0\u751F\u6210\u5BC6\u94A5\uFF08\u6240\u6709\u6570\u636E\u5757\u7684\u5BC6\u94A5\u662F\u76F8\u540C\u7684\uFF09\r\n    const { derived_key } = await derive_key(key, iv4key, phrase, N, salt);\r\n    const cryptoKey = await crypto.subtle.importKey('raw', derived_key, { name: 'AES-GCM' }, false, ['decrypt']);\r\n\r\n    ctx.key = cryptoKey;\r\n    ctx.chunk_size = chunk_size;\r\n    ctx.nonce_counter = nonce_counter;\r\n    ctx.header_json_length = json_len;\r\n    ctx.cache_enabled = !!cache;\r\n    ctx.cached_chunks = new Map();\r\n    ctx.cached_chunks_add_order = new Array();\r\n    ctx.cached_size = 0;\r\n    ctx.cache_max_size = cache_max_size;\r\n\r\n    return true;\r\n}\r\n\r\n\r\n/**\r\n * Decrypt a stream.\r\n * @param {CryptContext} ctx Context\r\n * @param {Number} bytes_start The start byte to decrypt\r\n * @param {Number} bytes_end The end byte to decrypt\r\n * @param {AbortController|null} abort The abort controller.\r\n * @returns {Promise<Blob>} The decrypted data, stored in a Blob object.\r\n */\r\nexport async function decrypt_stream(ctx, bytes_start, bytes_end, abort) {\r\n    if (!ctx._inited) throw new Exceptions.CryptContextNotInitedException();\r\n    if (ctx._type !== '@decrypt_stream') throw new Exceptions.InvalidCryptContextTypeException(ctx._type);\r\n    if (ctx._released) throw new Exceptions.CryptContextReleasedException();\r\n\r\n    /** @type {InputStream} */\r\n    const stream = ctx.stream.stream;\r\n    const chunk_size = ctx.chunk_size;\r\n    const nonce_counter_start = ctx.nonce_counter;\r\n    const result = [];\r\n    \r\n    // \u6587\u4EF6\u593416 + \u7248\u672C\u6807\u8BC64 + \u4E3B\u5BC6\u94A54096 + JSON\u957F\u5EA64 + JSON + chunk_size8 + IV8\r\n    const chunks_start = 16 + 4 + PADDING_SIZE + 4 + ctx.header_json_length + 8 + 8;\r\n    // tag 16\u5B57\u8282\r\n    const size_per_chunk = chunk_size + 16;\r\n\r\n    // \u786E\u5B9A\u9700\u8981\u89E3\u5BC6\u7684\u5206\u5757\u4F4D\u7F6E\r\n    const max_chunk = Math.floor((stream.size - chunks_start - (32 + 8 + 32 + 8 + FILE_END_MARKER.length)) / size_per_chunk);\r\n    const start_chunk = Math.max(0, Math.floor(bytes_start / chunk_size));\r\n    const end_chunk = Math.min(max_chunk, Math.floor(bytes_end / chunk_size));\r\n    if (end_chunk < 0 || start_chunk > max_chunk) throw new Exceptions.InvalidParameterException(\"Out of range\")\r\n\r\n    // \u7528\u4E8E\u8BFB\u53D6chunk\r\n    const read_chunk = async (chunk) => {\r\n        // \u68C0\u67E5\u7F13\u5B58\r\n        if (ctx.cache_enabled && ctx.cached_chunks.has(chunk)) {\r\n            return ctx.cached_chunks.get(chunk);\r\n        }\r\n\r\n        // \u5B9A\u4F4D\u5BF9\u5E94chunk\r\n        let pos = chunks_start + (chunk * size_per_chunk);\r\n        // \u8BFB\u53D68\u5B57\u8282\r\n        const eight_bytes = await stream.read(pos, pos + 8, pos + (2 * size_per_chunk), abort);\r\n        // \u5224\u65AD\u662F\u5426\u7279\u6B8A\u60C5\u51B5\r\n        let real_size = 0;\r\n        if ((eight_bytes).every((v, i) => v === END_IDENTIFIER[i])) {\r\n            const full_bytes = await stream.read(pos, pos + 32, null, abort); // \u8BFB\u53D6\u5B8C\u6574\u6807\u8BB0\r\n            pos += 32;\r\n            // \u5224\u65AD\u662F\u5426\u7ED3\u675F\r\n            if (full_bytes.every((v, i) => v === END_MARKER[i])) {\r\n                return false\r\n            }\r\n            if (full_bytes.every((v, i) => v === TAIL_BLOCK_MARKER[i])) {\r\n                // \u8BFB\u53D6\u5206\u5757\u957F\u5EA6\r\n                const chunk_len_bytes = await stream.read(pos, pos + 8, null, abort);\r\n                pos += 8;\r\n                real_size = Number(new DataView(chunk_len_bytes.buffer).getBigUint64(0, true));\r\n                if (real_size === 0) return false // \u8BFB\u53D6\u52300\u5B57\u8282\uFF0C\u7ED3\u675F\u5FAA\u73AF\r\n            }\r\n        }\r\n\r\n        // \u8BFB\u53D6\r\n        const ciphertext_length = (real_size ? real_size : chunk_size)\r\n        const ciphertext = await stream.read(pos, pos + ciphertext_length + 16, null, abort);\r\n        // \u83B7\u53D6iv\r\n        const nonce_counter = nonce_counter_start + chunk;\r\n        const iv_array = new ArrayBuffer(12);\r\n        new DataView(iv_array).setBigUint64(4, BigInt(nonce_counter), true);\r\n\r\n        // \u4F7F\u7528WebCrypto\u89E3\u5BC6\r\n        try {\r\n            const data = await crypto.subtle.decrypt(\r\n                {\r\n                    name: 'AES-GCM',\r\n                    iv: new Uint8Array(iv_array),\r\n                },\r\n                ctx.key,\r\n                ciphertext\r\n            );\r\n            // \u4FDD\u5B58\u5230\u7F13\u5B58\r\n            if (ctx.cache_enabled) {\r\n                if (data.byteLength < ctx.cache_max_size) {\r\n                    ctx.cached_chunks_add_order.push(chunk);\r\n                    ctx.cached_chunks.set(chunk, data);\r\n                    ctx.cached_size += data.byteLength;\r\n                }\r\n\r\n                // \u68C0\u67E5\u7F13\u5B58\u5927\u5C0F\r\n                while (ctx.cached_size > ctx.cache_max_size) {\r\n                    const oldest_chunk = ctx.cached_chunks_add_order.shift();\r\n                    ctx.cached_size -= ctx.cached_chunks.get(oldest_chunk).byteLength;\r\n                    ctx.cached_chunks.delete(oldest_chunk);\r\n                }\r\n            }\r\n            return data;\r\n        }\r\n        catch (e) {\r\n            if (!e || !(e instanceof DOMException)) throw new Exceptions.InternalError(`Internal error.`, { cause: e });\r\n            const name = e.name;\r\n            if (name === 'InvalidAccessError') throw new Exceptions.InvalidParameterException('InvalidAccessError.', { cause: e });\r\n            if (name === 'OperationError') throw new Exceptions.CannotDecryptException('Cannot decrypt. Did you provide the correct password?', { cause: e });\r\n            throw new Exceptions.InternalError(`Unexpected error.`, { cause: e });\r\n        }\r\n    };\r\n\r\n    // \u8BFB\u53D6chunk\r\n    let EOFbit = false;\r\n    for (let i = start_chunk; i <= end_chunk; i++) {\r\n        const decrypted_chunk = await read_chunk(i);\r\n        if (!decrypted_chunk) {\r\n            EOFbit = true;\r\n            break;\r\n        }\r\n        result.push(decrypted_chunk);\r\n    }\r\n\r\n    // \u5408\u6210Blob\r\n    const blob_full = new Blob(result);\r\n    // \u88C1\u526A\u9700\u8981\u7684\u90E8\u5206\r\n    const startpos = start_chunk * chunk_size;\r\n    // const endpos = (end_chunk + 1) * chunk_size - 1;\r\n    // bytes_start, bytes_end\r\n    const blob = blob_full.slice(bytes_start - startpos, bytes_end - startpos);\r\n    \r\n    // @ts-ignore\r\n    if (EOFbit) blob.eof = true;\r\n    return blob;\r\n}\r\n", "import { deriveKey__phrases } from \"./derive_key.js\";\r\nimport {\r\n    END_IDENTIFIER, END_MARKER, FILE_END_MARKER,\r\n    nextTick, PADDING_SIZE, TAIL_BLOCK_MARKER,\r\n    GetFileVersion, GetFileInfo, GetFileChunkSize,\r\n    POWER_2_64,\r\n} from \"./internal-util.js\";\r\n\r\nconst Internals = {\r\n    PADDING_SIZE,\r\n    END_IDENTIFIER,\r\n    TAIL_BLOCK_MARKER,\r\n    END_MARKER,\r\n    FILE_END_MARKER,\r\n    nextTick,\r\n    GetFileVersion,\r\n    GetFileInfo,\r\n    GetFileChunkSize,\r\n    derive_key_default_phrases_list: deriveKey__phrases,\r\n    POWER_2_64,\r\n};\r\n\r\nexport { Internals };", "import { NetworkError } from \"./exceptions.js\";\r\n\r\n\r\n/**\r\n * Create a file reader for local file.\r\n * @param {Blob} file The file handle. Can also be a File object from <input type=\"file\">.\r\n * @returns the file_reader.\r\n */\r\nexport async function createReaderForLocalFile(file) {\r\n    return async (/** @type {number} */ start, /** @type {number} */ end) => {\r\n        return new Uint8Array(await file.slice(start, end).arrayBuffer());\r\n    };\r\n}\r\n\r\n/**\r\n * Create a file reader for FileSystemFileHandle.\r\n * @param {FileSystemFileHandle} fileSystemHandle The file handle. Can only be a FileSystemFileHandle (using File System Access API like `window.showOpenFilePicker`)\r\n */\r\nexport async function createReaderForFileSystemHandle(fileSystemHandle) {\r\n    const file = await fileSystemHandle.getFile();\r\n    return await createReaderForLocalFile(file);\r\n}\r\n\r\n\r\n/**\r\n * Create a file reader for remote object.\r\n * This function will send a HTTP request to the server to get the file content.\r\n * @param {string} url\r\n */\r\nexport async function createReaderForRemoteObject(url) {\r\n    return async (/** @type {number} */ start, /** @type {number} */ end) => {\r\n        const resp = await fetch(url, {\r\n            headers: { Range: `bytes=${start}-${end - 1}` }\r\n        });\r\n        if (!resp.ok) throw new NetworkError(`Network Error: HTTP ${resp.status} : ${resp.statusText}`, {\r\n            response: resp\r\n        });\r\n        return new Uint8Array(await resp.arrayBuffer());\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * Create a file writer for memory buffer.\r\n * @param {Array} bufferOutput The buffer to store the output data.\r\n * @returns The writer function.\r\n */\r\nexport async function createWriterForMemoryBuffer(bufferOutput) {\r\n    return async (/** @type {Uint8Array} */ data) => {\r\n        bufferOutput.push(data);\r\n    };\r\n}\r\n", "export const VERSION = 'Encryption/5.6 FileEncryption/1.2 Patch/100.0 Package/1.100.0';\r\n"],
  "mappings": "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",
  "names": ["p", "i", "nextTick", "s", "crypto", "phrase", "salt", "N", "crypto", "crypto", "data", "crypto"]
}
