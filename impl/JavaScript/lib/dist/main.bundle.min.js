var st=Object.defineProperty;var Xe=(e,t)=>{for(var n in t)st(e,n,{get:t[n],enumerable:!0})};var Qe=new Array(256);for(let e=0;e<256;e++)Qe[e]=e.toString(16).padStart(2,"0");function $(e){if(!e||!(e instanceof Uint8Array))throw new TypeError("Input must be a Uint8Array");let t=e.length,n=new Array(t);for(let o=0;o<t;o++)n[o]=Qe[e[o]];return n.join("")}var qe={get InvalidHexStringException(){throw new TypeError("Invalid hex string")}};function C(e){if(typeof e!="string")throw new TypeError("Input must be a string");let t=e.length;if(t%2!==0)throw new TypeError("Hex string must have even length");e=e.toLowerCase();let n=new Uint8Array(t>>1);for(let o=0;o<t;o+=2){let i=e.charCodeAt(o),r=e.charCodeAt(o+1),a=i>=97&&i<=102?i-87:i>=48&&i<=57?i-48:qe.InvalidHexStringException,c=r>=97&&r<=102?r-87:r>=48&&r<=57?r-48:qe.InvalidHexStringException;n[o>>1]=a<<4|c}return n}var ct=globalThis.crypto;function Y(e){let t=new Uint8Array(e);return ct.getRandomValues(t),t}function pt(){let e=Y(1);return new Int8Array(e)[0]}function Ye(){let e=Y(1);return new Uint8Array(e)[0]}function V(e,t="utf-8"){if(typeof e!="string")throw new TypeError("Input must be a string");if(t.toLowerCase()!=="utf-8")throw new Error("Only 'utf-8' encoding is supported");return new TextEncoder().encode(e)}function d(e,t="utf-8"){if(e instanceof Uint8Array||(e=new Uint8Array(e)),t.toLowerCase()!=="utf-8")throw new Error("Only 'utf-8' encoding is supported");return new TextDecoder().decode(e)}var q={};Xe(q,{BadDataException:()=>U,CannotDecryptException:()=>pe,ChaCha20NotSupportedException:()=>Be,CryptContextNotInitedException:()=>Ue,CryptContextReleasedException:()=>ke,CryptContextReusedException:()=>De,DangerousEncryptionAlgorithmException:()=>Ce,DataError:()=>Z,DeprecationException:()=>Je,EncryptionAlgorithmNotSupportedException:()=>re,EncryptionError:()=>ge,EncryptionVersionMismatchException:()=>N,EndOfFileException:()=>We,ExpectedError:()=>Pe,FileCorruptedException:()=>we,IVException:()=>be,InputError:()=>se,InternalError:()=>g,InvalidCryptContextTypeException:()=>Ne,InvalidEndMarkerException:()=>de,InvalidFileFormatException:()=>ce,InvalidParameterException:()=>u,InvalidScryptParameterException:()=>ve,LibraryError:()=>_e,NetworkError:()=>Ae,NotSupportedException:()=>X,OperationNotPermittedException:()=>ne,ParameterError:()=>W,RuntimeException:()=>ae,UnexpectedError:()=>J,UnexpectedFailureInChunkDecryptionException:()=>Ie,UnhandledExceptionInUserCallback:()=>he,UserException:()=>Ve,VersionSystemError:()=>Se,raise:()=>He});var _e=class extends Error{constructor(t="Library Error",n=void 0){super(t,n),this.name="LibraryError"}};function He(e){throw e}var ge=class extends _e{constructor(t="Encryption Error",n=void 0){super(t,n),this.name="EncryptionError"}},Ae=class extends _e{constructor(t="(Network Error)",n=void 0){super(t,n),this.name="NetworkError"}},Pe=class extends ge{constructor(t="(Expected Error)",n=void 0){super(t,n),this.name="ExpectedError"}},ae=class extends ge{constructor(t="(Runtime Error)",n=void 0){super(t,n),this.name="RuntimeException"}},J=class extends ae{constructor(t="(Unexpected Error)",n=void 0){super(t,n),this.name="UnexpectedError"}},g=class extends J{constructor(t="(Internal Error)",n=void 0){super(t,n),this.name="InternalError"}},se=class extends ae{constructor(t="(Input Error)",n=void 0){super(t,n),this.name="InputError"}},W=class extends se{constructor(t="(Data Error)",n=void 0){super(t,n),this.name="ParameterError"}},Z=class extends se{constructor(t="(Data Error)",n=void 0){super(t,n),this.name="DataError"}},Ve=class extends ae{constructor(t="(The end user has a fault that caused the exception. This is not code bug.)",n=void 0){super(t,n),this.name="UserException"}},Se=class extends Z{constructor(t="(Version System Error)",n=void 0){super(t,n),this.name="VersionSystemError"}},u=class extends W{constructor(t="The parameter provided is invalid.",n=void 0){super(t,n),this.name="InvalidParameterException"}},U=class extends Z{constructor(t="The data is bad.",n=void 0){super(t,n),this.name="BadDataException"}},ve=class extends W{constructor(t="The N, r, or p is not valid or out of range.",n=void 0){super(t,n),this.name="InvalidScryptParameterException"}},N=class extends Se{constructor(t="The version of the encryption library doesn't match.",n=void 0){super(t,n),this.name="EncryptionVersionMismatchException"}},ce=class extends Z{constructor(t="The file format is invalid.",n=void 0){super(t,n),this.name="InvalidFileFormatException"}},be=class extends g{constructor(t="IV Exception.",n=void 0){super(t,n),this.name="IVException"}},we=class extends Z{constructor(t="File is corrupted.",n=void 0){super(t,n),this.name="FileCorruptedException"}},de=class extends Z{constructor(t="The end marker is invalid.",n=void 0){super(t,n),this.name="InvalidEndMarkerException"}},pe=class extends Ve{constructor(t="Cannot decrypt",n=void 0){super(t,n),this.name="CannotDecryptException"}},Ie=class extends J{constructor(t="An unexpected failure occurred while decrypting the chunk. The file may be corrupted.",n=void 0){super(t,n),this.name="UnexpectedFailureInChunkDecryptionException"}},De=class extends W{constructor(t="Not allowed to reuse a crypt context.",n=void 0){super(t,n),this.name="CryptContextReusedException"}},X=class extends se{constructor(t="Operation not supported",n=void 0){super(t,n),this.name="NotSupportedException"}},Je=class extends se{constructor(t="Trying to use a deprecated feature.",n=void 0){super(t,n),this.name="DeprecationException"}},We=class extends Pe{constructor(t="End of File",n=void 0){super(t,n),this.name="EndOfFileException",!(typeof process<"u")&&globalThis.console.warn(`%c[npm::simple-data-crypto] %c[EndOfFileException] %cDEPRECATED!! %cDeprecated and will be removed in the next MAJOR version. See %csrc/exceptions.js%c for more information.
%cNote: %cThis %cdoes not%c indicate the package is deprecated. Instead, it indicates that your code uses the %cdeprecated%c class %cEndOfFileException%c. Fix your code to suppress this warning.`,"color: #007700","color: #570263","color: red; font-weight: bold;","","font-weight: bold;","","font-weight: bold; color: #0000ff","","color: red; font-weight: bold;","","font-style: italic","","color: #570263","")}},Ue=class extends W{constructor(t="Crypt context is not initialized.",n=void 0){super(t,n),this.name="CryptContextNotInitedException"}},Ne=class extends W{constructor(t="Invalid crypt context type.",n=void 0){super(t,n),this.name="InvalidCryptContextTypeException"}},ke=class extends W{constructor(t="Crypt context has been released.",n=void 0){super(t,n),this.name="CryptContextReleasedException"}},ne=class extends W{constructor(t="Operation not permitted.",n=void 0){super(t,n),this.name="OperationNotPermittedException"}},re=class extends Z{constructor(t="The specified encryption algorithm is not supported.",n=void 0){super(t,n),this.name="EncryptionAlgorithmNotSupportedException"}},Be=class extends re{constructor(t="ChaCha20 is not supported yet.",n=void 0){super(t,n),this.name="ChaCha20NotSupportedException"}},Ce=class extends re{constructor(t="The specified encryption algorithm is DANGEROUS.",n=void 0){super(t,n),this.name="DangerousEncryptionAlgorithmException"}},he=class extends ae{constructor(t="An unhandled exception was encountered during a user callback.",n=void 0){super(t,n),this.name="UnhandledExceptionInUserCallback"}};function ut(e){return new Promise((t,n)=>{let o=document.createElement("script");o.src=e,o.onload=()=>t(o),o.onerror=i=>n(i),document.head.append(o)})}function et(e,t){return Reflect.has(globalThis,e)?Promise.resolve(Reflect.get(globalThis,e)):ut(t).then(()=>Reflect.get(globalThis,e))}var oe=await et("scrypt",import.meta.resolve("./WebScrypt/scrypt.js"));oe.setResPath(import.meta.resolve("./WebScrypt/asset/"));oe.load();var Te=function(){let e=[],t=!1,n=i=>new Promise(async(r,a)=>{oe.onprogress=c=>{i.onprogress&&i.onprogress(c)},oe.oncomplete=c=>{i.resolve(c),r(!0)},oe.onerror=c=>{i.reject(c),r(!1)};try{oe.config({N:i.N,r:i.r,P:i.p},{maxPassLen:8192,maxSaltLen:2048,maxDkLen:1024,maxThread:1}),await new Promise(c=>oe.onready=c),oe.hash(i.key,i.salt,i.dklen)}catch(c){a(c)}});async function o(){let i=null;for(;e.length;)try{i=e.splice(0,1)[0],await n(i),await ft()}catch(r){i?.reject(r)}t=!1}return function(r,a,c,f,s,p,l=null){return new Promise((w,m)=>{e.push({key:r,salt:a,N:c,r:f,p:s,dklen:p,resolve:w,reject:m,onprogress:l}),t||(t=!0,setTimeout(o))})}}();function ft(){return new Promise(e=>setTimeout(e))}var b=4096,ye=[85,170,85,170,85,170,85,170],ue=[85,170,85,170,85,170,85,170,170,85,170,85,170,85,170,85,85,170,85,170,85,170,85,170,170,85,170,85,170,85,170,85],fe=[85,170,85,170,85,170,85,170,85,170,85,170,85,170,85,170,85,170,85,170,85,170,85,170,85,170,85,170,85,170,85,170],Q=[255,253,240,16,19,208,18,24,85,170],Re=2n**64n;if(Re!==BigInt("18446744073709551616"))throw new J("POWER_2_64 is not 2^64");var lt=typeof process>"u"?requestAnimationFrame:setTimeout;function xe(){return new Promise(e=>lt(e))}function le(e,t=null){if(!e)return"Unknown Version";let n=String(t);return String(e)==="1.1"&&(n="null"),t?`${e}/${n}`:`${e}/0`}var ee=le("1.1"),te=le("1.2",10020);async function H(e){let t=await e(0,13);if(d(t)!=="MyEncryption/")throw new ce;let n=d(await e(13,16));if(!["1.1","1.2"].includes(n))throw new N;let o=new DataView((await e(16,20)).buffer).getUint32(0,!0);return le(n,o)}async function Fe(e){let t=await H(e);if(t===ee)throw new ne("The chunk size is volatile and we cannot get a fixed value.");if(t===te){let n=20,o=new DataView((await e(n,n+4)).buffer).getUint32(0,!0),i=d(await e(n+4,n+4+o));n+=b;let r=await e(n,n+4),a=new DataView(r.buffer).getUint32(0,!0);n+=4,n+=a;let c=Number(new DataView((await e(n,n+8)).buffer).getBigUint64(0,!0)),f=Number(new DataView((await e(n+8,n+16)).buffer).getBigUint64(0,!0));return{version:t,chunk_size:c,nonce_counter:f,ekey:i}}throw new N}async function tt(e){return(await Fe(e)).chunk_size}function Ee(e){if(e&&e!=="AES-GCM")throw e==="ChaCha20"||e==="ChaCha20-Poly1305"?new Be:e==="DES"||e==="RC4"?new Ce:e==="XTS-AES"?new re("XTS-AES is not supported yet"):new re(void 0,{cause:new Error(String(e))})}async function wt(e){if(typeof e!="string")return!1;if(e.charAt(0)===":"){let t=e.split(":");if(t.length===8){let[,n,o,i,r,a,c]=t;return!!(n&&o&&i&&r&&a&&c)}return!1}if(e.charAt(0)!=="{")return!1;try{let t=JSON.parse(e);return t.data&&t.parameter&&t.N&&t.v}catch{return!1}}async function dt(e){try{return!!(await Fe(e)).version}catch{return!1}}var Oe=globalThis.crypto;function ht(e){try{let t=JSON.parse(e);if(!t||!t.data||!t.parameter||!t.N||!t.v)throw new U("The message is bad since the JSON is not complete.");return t}catch{throw new U("The message is bad since it is neither a JSON or a new-format ciphertext.")}}async function ie(e,t,n=null,o=null){let i=Y(12),{derived_key:r,parameter:a,N:c}=await M(t,i,n,o);o=c;let f=await Oe.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]);if(typeof e!="string")throw e&&(e instanceof ArrayBuffer||e instanceof Uint8Array)?new ne("The ability to directly encrypt binary data has been removed in the new version. Please use `encrypt_file` instead."):new u("The message must be a string.");let s="AES-GCM",p=await Oe.subtle.encrypt({name:s,iv:i},f,V(e)),l=new Uint8Array(i.length+p.byteLength);return l.set(i,0),l.set(new Uint8Array(p),i.length),`:${$(l)}:${a}:${o}:${5.6}:${s}:`}async function Me(e){if(typeof e!="string")throw new u("The message is not a string.");let t;if(e.charAt(0)===":"){let l=e.split(":");if(l.length!==8)throw new U("The message is bad.");let[,w,m,E,x,T,O]=l;t={data:w,phrase:m,salt:E,N:+x,v:+T,a:O}}else t=ht(e);let n=parseInt(t.N),o=t.a;Ee(o);let i=C(t.data),r,a;t.parameter?[r,a]=t.parameter.split(":"):(r=t.phrase,a=t.salt);let c=C(a);if(isNaN(n)||!r||typeof r!="string"||!i||!c)throw new U("The message or parameters are bad.");if(i.length<28)throw new U("The message was too short.");let f=i.slice(0,12),s=i.slice(12,-16),p=i.slice(-16);return{iv:f,ciphertext:s,tag:p,phrase:r,salt:c,N:n}}async function F(e,t){let{iv:n,ciphertext:o,tag:i,phrase:r,salt:a,N:c}=await Me(e),f=typeof t=="string"?(await M(t,n,r,c,a)).derived_key:t;if(!(f instanceof Uint8Array))throw new u("The key is not valid.");let s=await Oe.subtle.importKey("raw",f,"AES-GCM",!1,["decrypt"]);try{let p=await Oe.subtle.decrypt({name:"AES-GCM",iv:n},s,new Uint8Array([...o,...i]));try{return d(p)}catch{throw new ne("The ability to directly decrypt binary data has been removed in the new version. If you have encrypted binary data, please recover it using the old version.")}}catch(p){if(!p||!(p instanceof DOMException))throw new g("Internal error.",{cause:p});let l=p.name;throw l==="InvalidAccessError"?new u("InvalidAccessError.",{cause:p}):l==="OperationError"?new pe("Cannot decrypt. Did you provide the correct password?",{cause:p}):new g("Unexpected error.",{cause:p})}}var Le=["Elysia","Kiana","Raiden","Bronya","Seele","Kevin","Cyrene","Furina","Neuvillette","Venti","Nahida","Kinich","Kazuha"];async function M(e,t,n=null,o=null,i=null,r=8,a=1,c=32){if(o||(o=262144),typeof o!="number"||o>4194304||r<1||a<1||typeof r!="number"||typeof a!="number"||typeof c!="number"||(o&o-1)!==0)throw new ve;if(typeof e!="string")throw new u("key must be a string");if(!(t instanceof Uint8Array))throw new u("iv must be a Uint8Array");if(n!==null&&typeof n!="string")throw new u("phrase must be a string");if(i||(i=Y(64)),n||(n=Le[Ye()%Le.length]),n.includes(":"))throw new u('phrase must not contain ":"');let f=`${n}:${$(i)}`,s=`MyEncryption/1.1 Fontaine/4.2 Iv/${$(t)} user_parameter=${f} user_key=${e}`;return{derived_key:await Te(V(s),i,o,r,a,c),parameter:f,N:o}}async function yt(e,t){let n=20,o=await H(e);if(o===ee)throw new X("Deriving a key for V1.1 files is not supported");if(o!==te)throw new N;let i=new DataView((await e(n,n+4)).buffer).getUint32(0,!0),r=d(await e(n+4,n+4+i));if(n+=b,i>b)throw new g("(Internal Error) This should not happen. Contact the application developer.");let a=await F(r,t),c=await e(n,n+4),f=new DataView(c.buffer).getUint32(0,!0);n+=4;let s=JSON.parse(d(await e(n,n+f)));n+=f;let p=s.v;if(![5.5].includes(p))throw new N;let[l,w]=s.parameter.split(":"),m=C(w),E=C(s.iv),x=s.N,T=s.a;return Ee(T),(await M(a,E,l,x,m)).derived_key}async function xt(e,t,n,o,i,r){return $(await Te(V(e),V(t),n,o,i,r))}var me=globalThis.crypto;async function nt(e,t,n,o=null,i=null,r=null,a=32*1024*1024){if(typeof e!="function"||typeof t!="function")throw new u("file_reader and file_writer must be functions");if(typeof n!="string")throw new u("user_key must be a string");if(!a)throw new u("chunk_size must be greater than 0.");let c=o;o=typeof o=="function"?async function(S){try{let B=c?.(S);B&&B instanceof Promise&&await B}catch(B){throw new he("An unhandled exception was encountered during a user callback.",{cause:B})}}:null,await t(V("MyEncryption/1.2"));let f=10020,s=new ArrayBuffer(4);new DataView(s).setUint32(0,f,!0),await t(new Uint8Array(s));let p=$(Y(128)),l=await ie(p,n,i,r),w=V(l);if(r=8192,w.length>b)throw new g("(Internal Error) This should not happen. Contact the application developer.");let m=new ArrayBuffer(4);new DataView(m).setUint32(0,w.length,!0),await t(new Uint8Array(m)),await t(w);let E=new Uint8Array(b-w.length-4).fill(0);await t(E),await o?.(0),await xe();let x=Y(12),{derived_key:T,parameter:O,N:A}=await M(p,x,i,r);r=A;let h={parameter:O,N:r,v:5.5,a:"AES-GCM",iv:$(x)},L=V(JSON.stringify(h)),R=new ArrayBuffer(4);new DataView(R).setUint32(0,L.length,!0),await t(new Uint8Array(R)),await t(L);let K=new ArrayBuffer(8);new DataView(K).setBigUint64(0,BigInt(a),!0),await t(new Uint8Array(K));let P=0,I=BigInt(1),k=0,y=new ArrayBuffer(8);new DataView(y).setBigUint64(0,I,!0),await t(new Uint8Array(y)),await o?.(0);let _=await me.subtle.importKey("raw",T,{name:"AES-GCM"},!1,["encrypt"]);for(;;){let D=await e(k,k+a);if(!(D instanceof Uint8Array))throw new U("The file chunk is not a Uint8Array.");if(D.length===0)break;let S=D.length<a,B=new ArrayBuffer(12);if(I>=Re)throw new be("nonce_counter exceeded the maximum value.");if(new DataView(B).setBigUint64(4,I,!0),I++,S){await t(new Uint8Array(ue));let v=new ArrayBuffer(8);new DataView(v).setBigUint64(0,BigInt(D.length),!0),await t(new Uint8Array(v))}let G=new Uint8Array(B),Ge=await me.subtle.encrypt({name:"AES-GCM",iv:G},_,D),je=new Uint8Array(Ge);await t(je),P+=D.length,k+=D.length,await o?.(P)}await t(new Uint8Array(fe));let z=new ArrayBuffer(8);return new DataView(z).setBigUint64(0,BigInt(P),!0),await t(new Uint8Array(z)),await t(new Uint8Array(Q)),!0}async function Et(e,t,n,o=null){let i=await e(0,16);if(d(i)!=="MyEncryption/1.1")throw new TypeError("Invalid file format");let r=16,a=await e(r,r+4),c=new DataView(a.buffer).getUint32(0,!0);r+=4;let f=d(await e(r,r+c));r+=1024;let s=await F(f,n),p=await e(r,r+4),l=new DataView(p.buffer).getUint32(0,!0);r+=4;let w=JSON.parse(d(await e(r,r+l)));r+=l;let[m,E]=w.parameter.split(":"),x=C(E),T=C(w.iv),O=w.N;o?.(0,0),await xe();let{derived_key:A}=await M(s,T,m,O,x),h=0,L=await me.subtle.importKey("raw",A,{name:"AES-GCM"},!1,["decrypt"]);for(;;){let I=await e(r,r+8);if(r+=8,I.every((S,B)=>S===[255,253,240,16,19,208,18,24][B]))break;let k=Number(new DataView(I.buffer).getBigUint64(0,!0)),y=await e(r,r+12);r+=12;let _=await e(r,r+k+16);r+=k+16;let z=_,D=await me.subtle.decrypt({name:"AES-GCM",iv:y},L,z);await t(new Uint8Array(D)),h+=D.byteLength,o&&o(h,r)}let R=await e(r,r+8),K=Number(new DataView(R.buffer).getBigUint64(0,!0));r+=8;let P=await e(r,r+2);if(h!==K)throw new we("File corrupted: total bytes mismatch");if(!P.every((I,k)=>I===[85,170][k]))throw new de("Invalid end marker");return o&&o(h,r+2),!0}async function rt(e,t,n,o=null){if(typeof e!="function"||typeof t!="function")throw new u("file_reader and file_writer must be functions");if(typeof n!="string"&&!(n instanceof ArrayBuffer)&&!(n instanceof Uint8Array))throw new u("user_key must be a string or ArrayBuffer or Uint8Array");let i=o;o=typeof o=="function"?async function(S,B){try{let G=i?.(S,B);G&&G instanceof Promise&&await G}catch(G){throw new he("An unhandled exception was encountered during a user callback.",{cause:G})}}:null;let r=20;if(await H(e)===ee){if(typeof n!="string")throw new X("operation not supported");return await Et(e,t,n,o)}let c=new DataView((await e(r,r+4)).buffer).getUint32(0,!0),f=d(await e(r+4,r+4+c));if(r+=b,c>b)throw new g("(Internal Error) This should not happen. Contact the application developer.");let s=typeof n=="string"?await F(f,n):null,p=await e(r,r+4),l=new DataView(p.buffer).getUint32(0,!0);r+=4;let w=JSON.parse(d(await e(r,r+l)));r+=l;let m=w.v;if(![5.5].includes(m))throw new N;let[E,x]=w.parameter.split(":"),T=C(x),O=C(w.iv),A=w.N,h=w.a;Ee(h);let L=Number(new DataView((await e(r,r+8)).buffer).getBigUint64(0,!0)),R=BigInt(new DataView((await e(r+8,r+16)).buffer).getBigUint64(0,!0));r+=16,await o?.(0,0),await xe();let K=typeof n=="string"?s?(await M(s,O,E,A,T)).derived_key:He(new g):n,P=0,I=!1,k=await me.subtle.importKey("raw",K,{name:"AES-GCM"},!1,["decrypt"]);for(;;){let D=await e(r,r+8),S=0;if(D.every((v,j)=>v===ye[j])){let v=await e(r,r+32);if(v.every((j,$e)=>j===fe[$e])){r+=32;break}if(v.every((j,$e)=>j===ue[$e])){I=!0,r+=32;let j=await e(r,r+8);if(r+=8,S=Number(new DataView(j.buffer).getBigUint64(0,!0)),S===0)break}}let B=I?S:L,G=new ArrayBuffer(12);new DataView(G).setBigUint64(4,BigInt(R),!0),R++;let Ge=await e(r,r+B+16);r+=B+16;let je=Ge;try{let v=await me.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(G)},k,je);await t(new Uint8Array(v)),P+=v.byteLength}catch(v){if(!v||!(v instanceof DOMException))throw new g("Internal error.",{cause:v});let j=v.name;throw j==="InvalidAccessError"?new u("InvalidAccessError.",{cause:v}):j==="OperationError"?new Ie(void 0,{cause:v}):new g("Unexpected error.",{cause:v})}o&&await o(P,r)}let y=await e(r,r+8),_=Number(new DataView(y.buffer).getBigUint64(0,!0));r+=8;let z=await e(r,r+Q.length);if(P!==_)throw new we("Total bytes mismatch");if(!z.every((D,S)=>D===Q[S]))throw new de;return o&&await o(P,r+Q.length),!0}async function mt(e,t,n,o,i,r){if(!(e instanceof Blob))throw new u("blob must be a Blob");let a=[];if(!await nt(async(s,p)=>new Uint8Array(await e.slice(s,p).arrayBuffer()),async s=>{a.push(s)},t,n,o,i,r))throw new J;return new Blob(a)}async function _t(e,t,n){if(!(e instanceof Blob))throw new u("blob must be a Blob");let o=[];if(!await rt(async(a,c)=>new Uint8Array(await e.slice(a,c).arrayBuffer()),async a=>{o.push(a)},t,n))throw new J;return new Blob(o)}async function gt(e,t,n){if(!(e instanceof Blob))throw new u;if(typeof t!="string"||typeof n!="string")throw new u;if(e.size<1044)throw new U("Data not enough");let o=await H(async(i,r)=>new Uint8Array(await e.slice(i,r).arrayBuffer()));if(o===ee){let i=new DataView(await e.slice(16,20).arrayBuffer()).getUint32(0,!0),r=await e.slice(20,20+i).arrayBuffer(),a=d(r);return await ie(await F(a,t),n)}if(o===te){if(e.size<16+b)throw new U("Data not enough");let i=new DataView(await e.slice(20,24).arrayBuffer()).getUint32(0,!0),r=await e.slice(24,24+i).arrayBuffer(),a=d(r);return await ie(await F(a,t),n)}throw new N}async function At(e,t,n){if(!(e instanceof Blob))throw new u;if(typeof t!="string"||typeof n!="string")throw new u;if(e.size<1044)throw new U("Data not enough");let o=e.slice(0,16);if(await o.text()!=="MyEncryption/1.1")throw new TypeError("Invalid file format");let r=new DataView(await e.slice(16,20).arrayBuffer()).getUint32(0,!0),a=d(await e.slice(20,20+r).arrayBuffer()),c=await ie(await F(a,t),n);if(c.length>1024)throw new Error("(Internal Error) This should not happen. Contact the application developer.");let f=c.length,s=new ArrayBuffer(4);new DataView(s).setUint32(0,f,!0);let l=[o,s,V(c)],w=new Uint8Array(1024-c.length).fill(0);return l.push(w),new Blob(l)}async function vt(e,t,n,o=null,i=null){if(!(e instanceof Blob))throw new u;if(typeof t!="string"||typeof n!="string")throw new u;if(e.size<1044)throw new U("Data not enough");if(await H(async(E,x)=>new Uint8Array(await e.slice(E,x).arrayBuffer()))===ee)return await At(e,t,n);let a=new DataView(await e.slice(20,24).arrayBuffer()).getUint32(0,!0),c=d(await e.slice(24,24+a).arrayBuffer());if(!i||!o){let{N:E,phrase:x}=await Me(c);i||(i=E),o||(o=x)}let f=await ie(await F(c,t),n,o,i);if(f.length>1024)throw new Error("(Internal Error) This should not happen. Contact the application developer.");let s=f.length,p=new ArrayBuffer(4);new DataView(p).setUint32(0,s,!0);let w=[e.slice(0,20),p,V(f)],m=new Uint8Array(b-f.length-4).fill(0);return w.push(m),new Blob(w)}var ze=Object.create(null);ze[Symbol.toStringTag]="CryptContext";ze.toString=function(){return`${this[Symbol.toStringTag]} Object`};async function Ke(e){return e instanceof Promise?await e:e}async function bt(){let e=Object.create(ze);return Object.defineProperty(e,"_created",{value:!0}),e}async function It(e){if(!e||e._released)throw new u("Invalid context");for(let t of Reflect.ownKeys(e)){if(typeof t=="symbol"){Reflect.deleteProperty(e,t);continue}let n=Reflect.get(e,t);n&&(n.release?await Ke(n.release()):n.free?await Ke(n.free()):n.reset?await Ke(n.reset()):n.clear&&await Ke(n.clear())),t.startsWith("_")||Reflect.deleteProperty(e,t)}return Object.defineProperty(e,"_released",{value:!0}),!0}var ot=globalThis.crypto,Ze=class{#n;#e={position:0,end:0,data:null};#t;get[Symbol.toStringTag](){return"Stream"}constructor(t,n){if(typeof t!="function")throw new u("Stream: Invalid reader");if(this.#n=t,typeof n!="number")throw new u("Stream: Invalid size");this.#t=n}get size(){return this.#t}#r=null;async read(t,n,o=null,i=null){if(!this.#n)throw new Error("Stream: The stream has been closed.");if(this.#e.position!=null&&this.#e.end&&this.#e.data&&t>=this.#e.position&&n<=this.#e.end)return this.#e.data.slice(t-this.#e.position,n-this.#e.position);if(t<0)throw new u("Stream: Invalid start position");if(n>this.#t&&(n=this.#t),o!=null&&o>this.#t&&(o=this.#t),this.#r=i,o!=null&&o!==0){let a=await this.#n(t,o,i?.signal);return this.#r=null,this.#e.position=t,this.#e.end=t+a.length,this.#e.data=a,a.slice(0,n-t)}let r=await this.#n(t,n,i?.signal);return this.#r=null,r}abort(){this.#r?.abort()}purge(){this.#e.position=this.#e.end=0,this.#e.data=null}close(){this.#n=null,this.purge()}};async function Dt(e,t,n,{cache:o=!0,cache_max_size:i=256*1024*1024}={}){if(e._inited)throw new De;Object.defineProperty(e,"_inited",{value:!0}),e._type="@decrypt_stream",e.stream={stream:t,release:()=>e.stream.stream.close()};let r=await t.read(0,13,5e3);if(d(r)!=="MyEncryption/")throw new ce;let a=d(await t.read(13,16));if(!["1.1","1.2"].includes(a))throw new N;let c=new DataView((await t.read(16,20)).buffer).getUint32(0,!0),f=le(a,c),s=20;if(f!==te)throw new X("Cannot perform a streamed decryption on V1.1 files");let p=new DataView((await t.read(s,s+4)).buffer).getUint32(0,!0),l=d(await t.read(s+4,s+4+p));if(s+=b,p>b)throw new g("(Internal Error) This should not happen. Contact the application developer.");let w=await F(l,n),m=await t.read(s,s+4),E=new DataView(m.buffer).getUint32(0,!0);s+=4;let x=JSON.parse(d(await t.read(s,s+E)));s+=E;let T=x.v;if(![5.5].includes(T))throw new N;let[O,A]=x.parameter.split(":"),h=C(A),L=C(x.iv),R=x.N,K=Number(new DataView((await t.read(s,s+8)).buffer).getBigUint64(0,!0)),P=Number(new DataView((await t.read(s+8,s+16)).buffer).getBigUint64(0,!0));s+=16;let{derived_key:I}=await M(w,L,O,R,h),k=await ot.subtle.importKey("raw",I,{name:"AES-GCM"},!1,["decrypt"]);return e.key=k,e.chunk_size=K,e.nonce_counter=P,e.header_json_length=E,e.cache_enabled=!!o,e.cached_chunks=new Map,e.cached_chunks_add_order=new Array,e.cached_size=0,e.cache_max_size=i,!0}async function Ut(e,t,n,o){if(!e._inited)throw new Ue;if(e._type!=="@decrypt_stream")throw new Ne(e._type);if(e._released)throw new ke;let i=e.stream.stream,r=e.chunk_size,a=e.nonce_counter,c=[],f=20+b+4+e.header_json_length+8+8,s=r+16,p=Math.floor((i.size-f-(80+Q.length))/s),l=Math.max(0,Math.floor(t/r)),w=Math.min(p,Math.floor(n/r));if(w<0||l>p)throw new u("Out of range");let m=async A=>{if(e.cache_enabled&&e.cached_chunks.has(A))return e.cached_chunks.get(A);let h=f+A*s,L=await i.read(h,h+8,h+2*s,o),R=0;if(L.every((y,_)=>y===ye[_])){let y=await i.read(h,h+32,null,o);if(h+=32,y.every((_,z)=>_===fe[z]))return!1;if(y.every((_,z)=>_===ue[z])){let _=await i.read(h,h+8,null,o);if(h+=8,R=Number(new DataView(_.buffer).getBigUint64(0,!0)),R===0)return!1}}let K=R||r,P=await i.read(h,h+K+16,null,o),I=a+A,k=new ArrayBuffer(12);new DataView(k).setBigUint64(4,BigInt(I),!0);try{let y=await ot.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(k)},e.key,P);if(e.cache_enabled)for(y.byteLength<e.cache_max_size&&(e.cached_chunks_add_order.push(A),e.cached_chunks.set(A,y),e.cached_size+=y.byteLength);e.cached_size>e.cache_max_size;){let _=e.cached_chunks_add_order.shift();e.cached_size-=e.cached_chunks.get(_).byteLength,e.cached_chunks.delete(_)}return y}catch(y){if(!y||!(y instanceof DOMException))throw new g("Internal error.",{cause:y});let _=y.name;throw _==="InvalidAccessError"?new u("InvalidAccessError.",{cause:y}):_==="OperationError"?new pe("Cannot decrypt. Did you provide the correct password?",{cause:y}):new g("Unexpected error.",{cause:y})}},E=!1;for(let A=l;A<=w;A++){let h=await m(A);if(!h){E=!0;break}c.push(h)}let x=new Blob(c),T=l*r,O=x.slice(t-T,n-T);return E&&(O.eof=!0),O}var Nt={PADDING_SIZE:b,END_IDENTIFIER:ye,TAIL_BLOCK_MARKER:ue,END_MARKER:fe,FILE_END_MARKER:Q,nextTick:xe,GetFileVersion:H,GetFileInfo:Fe,GetFileChunkSize:tt,derive_key_default_phrases_list:Le,POWER_2_64:Re};var at={};Xe(at,{createReaderForFileSystemHandle:()=>kt,createReaderForLocalFile:()=>it,createReaderForRemoteObject:()=>Bt,createWriterForMemoryBuffer:()=>Ct});async function it(e){return async(t,n)=>new Uint8Array(await e.slice(t,n).arrayBuffer())}async function kt(e){let t=await e.getFile();return await it(t)}async function Bt(e){return async(t,n)=>{let o=await fetch(e,{headers:{Range:`bytes=${t}-${n-1}`}});if(!o.ok)throw new Ae(`Network Error: HTTP ${o.status} : ${o.statusText}`,{response:o});return new Uint8Array(await o.arrayBuffer())}}async function Ct(e){return async t=>{e.push(t)}}var Tt="Encryption/5.6 FileEncryption/1.2 Patch/100.0 Package/1.100.0";export{ze as CryptContext,ee as ENCRYPTION_FILE_VER_1_1_0,te as ENCRYPTION_FILE_VER_1_2_10020,q as Exceptions,Ze as InputStream,Nt as Internals,Tt as VERSION,at as Wrappers,vt as change_file_password,bt as crypt_context_create,It as crypt_context_destroy,_t as decrypt_blob,F as decrypt_data,rt as decrypt_file,Ut as decrypt_stream,Dt as decrypt_stream_init,M as derive_key,yt as derive_key_for_file,mt as encrypt_blob,ie as encrypt_data,nt as encrypt_file,gt as export_master_key,Y as get_random_bytes,pt as get_random_int8_number,Ye as get_random_uint8_number,$ as hexlify,dt as is_encrypted_file,wt as is_encrypted_message,le as normalize_version,Me as parse_ciphertext,Te as scrypt,xt as scrypt_hex,d as str_decode,V as str_encode,C as unhexlify};
//# sourceMappingURL=main.bundle.min.js.map
